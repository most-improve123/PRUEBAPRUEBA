prueba.html

<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>WeSpark Certificate Platform</title>

    <link rel="stylesheet" href="prueba.css">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>

        // Configuración de Firebase

       // Configuración de Firebase para Auth y Users

const firebaseConfigAuth = {

  apiKey: "AIzaSyB43ne5sv_2-CzPC-GoNbBM5uNGiTHlQ0Q",

  authDomain: "users-ab3e0.firebaseapp.com",

  projectId: "users-ab3e0",

  storageBucket: "users-ab3e0.firebasestorage.app",

  messagingSenderId: "466535430209",

  appId: "1:466535430209:web:4e49fde0578fb037042ec0"

};

// Configuración de Firebase para Certificates

const firebaseConfigCertificates = {

  apiKey: "AIzaSyCmTISieA5tp7AKtXM0Vuf5afFuCZXv33k",

  authDomain: "wses-a18fa.firebaseapp.com",

  projectId: "wses-a18fa",

  storageBucket: "wses-a18fa.appspot.com",

  messagingSenderId: "147530546947",

  appId: "1:147530546947:web:236f6e900decf4b0bab336"

};

// Inicializar Firebase para Auth y Users

const appAuth = firebase.initializeApp(firebaseConfigAuth, "appAuth");

const auth = appAuth.auth();

const dbUsers = appAuth.firestore();

 window.auth = auth;

    window.dbUsers = dbUsers;

// Inicializar Firebase para Certificates

const appCertificates = firebase.initializeApp(firebaseConfigCertificates, "appCertificates");

const dbCertificates = appCertificates.firestore();

    </script>

</head>

<body>

    

    <!-- Header -->

    <header class="header">

        <div class="header-container">

            <div class="logo">

                <i class="fas fa-graduation-cap"></i>

                <span>WeSpark</span>

            </div>

            <div class="nav-section">

                <div class="nav-buttons">

                    <button class="nav-btn active" data-view="graduate">Graduate</button>

                    <button class="nav-btn" data-view="verifier">Verifier</button>

                    <button class="nav-btn" data-view="admin">Admin</button>

                </div>

                <div class="user-info">

                    <i class="fas fa-user"></i>

                    <span id="user-name">John Doe</span>

                    <!-- Botón de Logout -->

                    <button class="btn btn-outline logout-btn" onclick="logout()">

                        <i class="fas fa-sign-out-alt"></i>

                    </button>

                </div>

            </div>

        </div>

    </header>

    <!-- Loading Spinner -->

    <div id="loading" class="loading hidden">

        <div class="spinner"></div>

    </div>

    <!-- Graduate Dashboard -->

    <div id="graduate-view" class="view active">

        <main class="main-content">

            <center>

                <div class="content-header">

                    <h1>My Certificates</h1>

                    <p>Manage and download your course certificates</p>

                </div>

            </center>

            <!-- Stats Cards -->

            <center>

                <div class="stats-grid">

                    <div class="stats-card">

                        <div class="stats-icon bg-primary">

                            <i class="fas fa-tag"></i>

                        </div>

                        <center>

                            <div class="stats-content">

                                <div class="stats-title">Total Certificates</div>

                                <div class="stats-value" id="total-certificates">0</div>

                            </div>

                        </center>

                    </div>

                    <div class="stats-card">

                        <div class="stats-icon bg-secondary-green">

                            <i class="fas fa-clock"></i>

                        </div>

                        <div class="stats-content">

                            <div class="stats-title">Hours Completed</div>

                            <center>

                                <div class="stats-value" id="total-hours">0</div>

                            </center>

                        </div>

                    </div>

                    <div class="stats-card">

                        <div class="stats-icon bg-accent-orange">

                            <i class="fas fa-trophy"></i>

                        </div>

                        <div class="stats-content">

                            <center>

                                <div class="stats-title">Skill Level</div>

                            </center>

                            <div class="stats-value">Advanced</div>

                        </div>

                    </div>

                    <div class="stats-card">

                        <div class="stats-icon bg-purple">

                            <i class="fas fa-star"></i>

                        </div>

                        <div class="stats-content">

                            <center>

                                <div class="stats-title">Advanced</div>

                            </center>

                            <div class="stats-value">congrats!</div>

                        </div>

                    </div>

                </div>

            </center>

            <!-- Certificates Grid -->

            <div id="certificates-grid" class="certificates-grid">

                <!-- Certificates will be loaded here -->

            </div>

        </main>

    </div>

    <!-- Verifier View -->

    <div id="verifier-view" class="view">

        <main class="main-content">

            <div class="verifier-container">

                <div class="verifier-header">

                    <div class="verifier-icon">

                        <i class="fas fa-search"></i>

                    </div>

                    <h1>Certificate Verification</h1>

                    <p>Enter a certificate number to verify its authenticity and view details</p>

                </div>

                <div class="card verification-card">

                    <div class="card-content">

                        <div class="verify-form-container">

                            <label for="certificate-id">Certificate Number</label>

                            <div class="verify-input-group">

                                <input type="text" id="certificate-id" placeholder="Enter certificate number (e.g., WS-2025-001)" class="verify-input">

                                <button class="btn btn-primary" onclick="verifyCertificate()">

                                    <span class="verify-btn-text">Verify</span>

                                    <div class="verify-btn-spinner hidden">

                                        <div class="spinner-small"></div>

                                    </div>

                                </button>

                            </div>

                            <p class="verify-hint">Certificate numbers are case-sensitive</p>

                        </div>

                    </div>

                </div>

                <div id="verification-result" class="hidden"></div>

            </div>

        </main>

    </div>

    <!-- Admin View -->

    <div id="admin-view" class="view">

        <main class="main-content">

            <center>

                <div class="content-header">

                    <h1>Admin Dashboard</h1>

                    <p>Manage users, courses, and certificates</p>

                </div>

            </center>

            <!-- Admin Stats -->

            <center>

                <div class="stats-grid">

                    <div class="stats-card">

                        <div class="stats-icon bg-primary">

                            <i class="fas fa-users"></i>

                        </div>

                        <div class="stats-content">

                            <div class="stats-title">Total Users</div>

                            <center>

                                <div class="stats-value" id="admin-total-users">0</div>

                            </center>

                        </div>

                    </div>

                    <div class="stats-card">

                        <div class="stats-icon bg-secondary-green">

                            <i class="fas fa-book"></i>

                        </div>

                        <div class="stats-content">

                            <div class="stats-title">Total Courses</div>

                            <center>

                                <div class="stats-value" id="admin-total-courses">0</div>

                            </center>

                        </div>

                    </div>

                    <div class="stats-card">

                        <div class="stats-icon bg-accent-orange">

                            <i class="fas fa-certificate"></i>

                        </div>

                        <div class="stats-content">

                            <div class="stats-title">Total Certificates</div>

                            <center>

                                <div class="stats-value" id="admin-total-certificates">0</div>

                            </center>

                        </div>

                    </div>

                    <div class="stats-card">

                        <div class="stats-icon bg-purple">

                            <i class="fas fa-chart-line"></i>

                        </div>

                        <div class="stats-content">

                            <div class="stats-title">Growth Rate</div>

                            <center>

                                <div class="stats-value">+12%</div>

                            </center>

                        </div>

                    </div>

                </div>

            </center>

            <!-- Admin Tabs -->

            <div class="tabs">

                <div class="tabs-list">

                    <button class="tab-trigger active" data-tab="users">Users</button>

                    <button class="tab-trigger" data-tab="courses">Courses</button>

                    <button class="tab-trigger" data-tab="certificates">Certificates</button>

                    <button class="tab-trigger" data-tab="import">Import</button>

                </div>

                <!-- Users Tab -->

                <div id="users-tab" class="tab-content active">

                    <div class="tab-header">

                        <div class="search-container">

                            <i class="fas fa-search"></i>

                            <input type="text" id="users-search" placeholder="Search users...">

                        </div>

                        <button class="btn btn-primary" onclick="showUserForm()">

                            <i class="fas fa-plus"></i> Add User

                        </button>

                    </div>

                    <div id="user-form-container" class="hidden">

                        <div class="card">

                            <div class="card-header">

                                <h3 id="user-form-title">Add User</h3>

                            </div>

                            <div class="card-content">

                                <form id="user-form">

                                    <div class="form-group">

                                        <label for="user-name">Name</label>

                                        <input type="text" id="user-name" required>

                                    </div>

                                    <div class="form-group">

                                        <label for="user-email">Email</label>

                                        <input type="email" id="user-email" required>

                                    </div>

                                    <div class="form-group">

                                        <label for="user-role">Role</label>

                                        <select id="user-role" required>

                                            <option value="graduate">Graduate</option>

                                            <option value="admin">Admin</option>

                                        </select>

                                    </div>

                                    <div class="form-actions">

                                        <button type="button" class="btn btn-outline" onclick="hideUserForm()">Cancel</button>

                                        <button type="submit" class="btn btn-primary">Save</button>

                                    </div>

                                </form>

                            </div>

                        </div>

                    </div>

                    <div id="users-table-container">

                        <!-- Users table will be loaded here -->

                    </div>

                </div>

                <!-- Courses Tab -->

                <div id="courses-tab" class="tab-content">

                    <div id="course-form-container" class="hidden">

                        <div class="card">

                            <div class="card-header">

                                <h3 id="course-form-title">Add Course</h3>

                            </div>

                            <div class="card-content">

                                <form id="course-form">

                                    <div class="form-group">

                                        <label for="course-title">Title</label>

                                        <input type="text" id="course-title" required>

                                    </div>

                                    <div class="form-group">

                                        <label for="course-description">Description</label>

                                        <textarea id="course-description" required></textarea>

                                    </div>

                                    <div class="form-group">

                                        <label for="course-duration">Duration (hours)</label>

                                        <input type="number" id="course-duration" required>

                                    </div>

                                   <div class="form-group">

  <label>Users in Course</label>

  <div id="course-users-checkboxes" class="checkbox-group">

    <!-- Los checkboxes se llenarán dinámicamente con JavaScript -->

  </div>

</div>

                                    <div class="form-group">

                                        <label for="course-image">Course Image</label>

                                        <input type="file" id="course-image" accept="image/*">

                                        <img id="course-image-preview" src="#" alt="Preview" style="max-width: 100px; max-height: 100px; display: none;">

                                    </div>

                                    <div class="form-actions">

                                        <button type="button" class="btn btn-outline" onclick="cancelCourseForm()">Cancel</button>

                                        <button type="submit" class="btn btn-primary">Save</button>

                                    </div>

                                </form>

                            </div>

                        </div>

                    </div>

                    <div class="tab-header">

                        <div class="search-container">

                            <i class="fas fa-search"></i>

                            <input type="text" id="courses-search" placeholder="Search courses...">

                        </div>

                        <button class="btn btn-primary" onclick="addCourse()">

                            <i class="fas fa-plus"></i> Add Course

                        </button>

                    </div>

                    <div id="courses-table-container">

                        <!-- Courses table will be loaded here -->

                    </div>

                </div>

                <!-- Certificates Tab -->

                <div id="certificates-tab" class="tab-content">

                    <div class="tab-header">

                        <div class="search-container">

                            <i class="fas fa-search"></i>

                            <input type="text" id="certificates-search" placeholder="Search certificates...">

                        </div>

                    </div>

                    <div id="certificates-table-container">

                        <!-- Certificates table will be loaded here -->

                    </div>

                </div>

                <!-- Import Tab -->

                <div id="import-tab" class="tab-content">

                    <div class="import-container">

                        <div class="card">

                            <div class="card-header">

                                <h3>Import CSV Data</h3>

                            </div>

                            <div class="card-content">

                                <div class="file-upload-area" id="file-upload-area">

                                    <i class="fas fa-cloud-upload-alt"></i>

                                    <h4>Drag and drop your CSV file here</h4>

                                    <p>or click to browse files</p>

                                    <input type="file" id="csv-file" accept=".csv" hidden>

                                </div>

                                <div id="file-info" class="file-info hidden">

                                    <i class="fas fa-file-csv"></i>

                                    <span id="file-name"></span>

                                    <button onclick="clearFile()">

                                        <i class="fas fa-times"></i>

                                    </button>

                                </div>

                                <button class="btn btn-primary" id="import-btn" disabled onclick="importCsv()">

                                    Import Data

                                </button>

                            </div>

                        </div>

                    </div>

                </div>

            </div>

        </main>

    </div>

    <!-- Mobile Navigation -->

    <div class="mobile-nav">

        <button class="mobile-nav-btn active" data-view="graduate">

            <i class="fas fa-graduation-cap"></i>

            <span>Graduate</span>

        </button>

        <button class="mobile-nav-btn" data-view="verifier">

            <i class="fas fa-search"></i>

            <span>Verifier</span>

        </button>

        <button class="mobile-nav-btn" data-view="admin">

            <i class="fas fa-cog"></i>

            <span>Admin</span>

        </button>

    </div>

    <!-- Toast Notifications -->

    <div id="toast-container"></div>

    <!-- Dialogs will be inserted here dynamically -->

    <div id="dialog-container"></div>

    <script src="prueba.js"></script>

    

    <!-- Confirmation Toast -->

<div id="confirmation-toast-container"></div>

</body>

</html>





prueba.css

/* CSS Variables - Exact replica from React project */

:root {

  --background: hsl(0, 0%, 100%);

  --foreground: hsl(240, 10%, 3.9%);

  --muted: hsl(240, 4.8%, 95.9%);

  --muted-foreground: hsl(240, 5%, 64.9%);

  --popover: hsl(0, 0%, 100%);

  --popover-foreground: hsl(240, 10%, 3.9%);

  --card: hsl(0, 0%, 100%);

  --card-foreground: hsl(240, 10%, 3.9%);

  --border: hsl(240, 5.9%, 90%);

  --input: hsl(240, 5.9%, 90%);

  --primary: #FCD307;

  --primary-foreground: hsl(0, 0%, 0%);

  --secondary: hsl(240, 4.8%, 95.9%);

  --secondary-foreground: hsl(240, 5.9%, 10%);

  --accent: hsl(240, 4.8%, 95.9%);

  --accent-foreground: hsl(240, 5.9%, 10%);

  --destructive: hsl(0, 84.2%, 60.2%);

  --destructive-foreground: hsl(60, 9.1%, 97.8%);

  --ring: hsl(240, 10%, 3.9%);

  --radius: 0.5rem;

  

  /* Custom colors from design */

  --primary-blue: hsl(207, 90%, 54%);

  --secondary-green: hsl(122, 39%, 49%);

  --accent-orange: hsl(33, 100%, 50%);

  --neutral-50: hsl(0, 0%, 98%);

  --neutral-100: hsl(0, 0%, 96%);

  --neutral-200: hsl(0, 0%, 88%);

  --neutral-400: hsl(0, 0%, 62%);

  --neutral-600: hsl(0, 0%, 44%);

  --neutral-800: hsl(0, 0%, 26%);

  --purple: hsl(270, 91%, 65%);

}

/* Reset */

* {

  margin: 0;

  padding: 0;

  box-sizing: border-box;

  border-color: var(--border);

}

body {

  font-family: 'Inter', sans-serif;

  -webkit-font-smoothing: antialiased;

  background-color: var(--background);

  color: var(--foreground);

  line-height: 1.6;

}

/* Header */

.header {

  background: white;

  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);

  border-bottom: 1px solid var(--neutral-200);

  position: sticky;

  top: 0;

  z-index: 50;

}

.header-container {

  max-width: 80rem;

  margin: 0 auto;

  padding: 0 1rem;

  display: flex;

  justify-content: space-between;

  align-items: center;

  height: 4rem;

}

.logo {

  display: flex;

  flex-shrink: 0;

  align-items: center;

}

.logo i {

  color: var(--primary);

  font-size: 1.5rem;

  margin-right: 0.5rem;

}

.logo span {

  font-size: 1.25rem;

  font-weight: 700;

  color: var(--neutral-800);

}

.nav-section {

  display: flex;

  align-items: center;

  gap: 1rem;

}

.nav-buttons {

  display: none;

  gap: 0.25rem;

}

/* Estilos para el modal de recuperación de contraseña */

.modal {

    position: fixed;

    top: 0;

    left: 0;

    width: 100%;

    height: 100%;

    background-color: rgba(0, 0, 0, 0.5);

    display: flex;

    justify-content: center;

    align-items: center;

    z-index: 1000;

}

.modal-content {

    background-color: white;

    padding: 2rem;

    border-radius: 0.5rem;

    width: 100%;

    max-width: 400px;

    position: relative;

}

.close-modal {

    position: absolute;

    top: 1rem;

    right: 1rem;

    font-size: 1.5rem;

    cursor: pointer;

}

.hidden {

    display: none !important;

}

.logout-btn {

    margin-left: 0.5rem;

    padding: 0.25rem 0.5rem;

    font-size: 0.875rem;

}

@media (min-width: 768px) {

  .nav-buttons {

    display: flex;

  }

}

.login-container {

    display: flex;

    justify-content: center;

    align-items: center;

    height: 100vh;

    background-color: var(--background);

}

#course-users {

    height: 120px;

    padding: 0.5rem;

    border-radius: 0.375rem;

    border: 1px solid var(--neutral-200);

    font-size: 0.875rem;

    background: white;

}

#course-users option {

    padding: 0.25rem 0.5rem;

}

/* Estilo para el grupo de checkboxes */

.checkbox-group {

  display: flex;

  flex-direction: column;

  gap: 0.5rem;

  max-height: 200px;

  overflow-y: auto;

  padding: 0.5rem;

  border: 1px solid var(--neutral-200);

  border-radius: 0.375rem;

  background: white;

}

/* Estilo para cada checkbox */

.checkbox-item {

  display: flex;

  align-items: center;

  gap: 0.5rem;

}

/* Toast Warning */

.toast.warning {

  position: fixed;

  top: 20%; /* Posiciona más arriba */

  left: 50%;

  transform: translateX(-50%); /* Centra horizontalmente */

  border-left: 4px solid var(--destructive);

  background: white;

  border: 1px solid var(--neutral-200);

  border-radius: 0.375rem;

  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);

  padding: 1rem;

  max-width: 32rem;

  width: 90%;

  z-index: 2000; /* Asegura que esté encima de todo */

  animation: slideIn 0.3s ease-out;

}

@keyframes slideIn {

  from {

    top: 10%;

    opacity: 0;

  }

  to {

    top: 20%;

    opacity: 1;

  }

}

#toast-container {

  position: fixed;

  top: 0;

  left: 0;

  width: 100%;

  height: 100%;

  pointer-events: none;

  z-index: 1000; /* Menor que el z-index del toast.warning */

}

.toast-header i {

  color: var(--destructive);

  font-size: 1.125rem;

}

.toast-title {

  font-weight: 600;

  color: var(--neutral-800);

}

.toast-description {

  color: var(--neutral-600);

  font-size: 0.875rem;

  margin: 0.5rem 0;

}

.toast-actions {

  display: flex;

  justify-content: flex-end;

  gap: 0.5rem;

  margin-top: 1rem;

}

/* Estilo para el checkbox personalizado */

.checkbox-item input[type="checkbox"] {

  width: 1.125rem;

  height: 1.125rem;

  accent-color: var(--primary);

  cursor: pointer;

}

/* Estilo para la etiqueta del checkbox */

.checkbox-item label {

  font-size: 0.875rem;

  color: var(--neutral-800);

  cursor: pointer;

  user-select: none;

}

.login-card {

    background: white;

    border-radius: 0.5rem;

    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);

    padding: 2rem;

    width: 100%;

    max-width: 24rem;

    text-align: center;

}

.login-card .logo {

    margin-bottom: 1.5rem;

}

.login-card h2 {

    font-size: 1.5rem;

    font-weight: 700;

    color: var(--neutral-800);

    margin-bottom: 0.5rem;

}

.login-card p {

    color: var(--neutral-600);

    margin-bottom: 1.5rem;

}

.form-group {

    margin-bottom: 1rem;

    text-align: left;

}

.form-group label {

    display: block;

    margin-bottom: 0.5rem;

    font-size: 0.875rem;

    font-weight: 500;

    color: var(--neutral-700);

}

.form-group input, .form-group select {

    width: 100%;

    padding: 0.75rem;

    border: 1px solid var(--neutral-200);

    border-radius: 0.375rem;

    font-size: 0.875rem;

}

.form-group input:focus, .form-group select:focus {

    outline: none;

    border-color: var(--primary);

}

.btn {

    width: 100%;

    padding: 0.75rem;

    margin-top: 1rem;

}

.login-footer {

    margin-top: 1.5rem;

    color: var(--neutral-600);

    font-size: 0.875rem;

}

.login-footer a {

    color: var(--primary);

    text-decoration: none;

    font-weight: 500;

}

.login-footer a:hover {

    text-decoration: underline;

}

.nav-btn {

  padding: 0.5rem 1rem;

  border-radius: 0.375rem;

  font-size: 0.875rem;

  font-weight: 500;

  background: transparent;

  border: none;

  cursor: pointer;

  transition: all 0.2s;

  color: var(--neutral-800);

}

.nav-btn:hover {

  background-color: var(--neutral-100);

}

.nav-btn.active {

  background-color: var(--primary);

  color: white;

}

.user-info {

  display: flex;

  align-items: center;

  gap: 0.5rem;

}

.user-info i {

  color: var(--neutral-400);

  font-size: 1.25rem;

}

.user-info span {

  font-size: 0.875rem;

  color: var(--neutral-800);

}

/* Views */

.view {

  display: none;

  min-height: calc(100vh - 4rem);

}

.view.active {

  display: block;

}

.main-content {

  max-width: 80rem;

  margin: 0 auto;

  padding: 2rem 1rem;

  padding-bottom: 5rem;

}

@media (min-width: 768px) {

  .main-content {

    padding-bottom: 2rem;

  }

}

.content-header {

  margin-bottom: 2rem;

}

.content-header h1 {

  font-size: 1.875rem;

  font-weight: 700;

  color: var(--neutral-800);

  margin-bottom: 0.5rem;

}

.content-header p {

  color: var(--neutral-600);

}

/* Stats Grid */

.stats-grid {

  display: grid;

  grid-template-columns: repeat(1, minmax(0, 1fr)); /* Una columna para móviles */

  gap: 9rem;

  margin-bottom: 2rem;

  justify-content: center; /* Centra toda la cuadrícula en el contenedor */

  width: 90%;

}

@media (min-width: 768px) {

  .stats-grid {

    grid-template-columns: repeat(4, minmax(0, 1fr)); /* Tres columnas para pantallas más grandes */

  }

}

.stats-card {

  background: white;

  padding: 1.5rem;

  border-radius: 0.5rem;

  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);

  border: 1px solid var(--neutral-200);

  display: flex;

  flex-direction: column; /* Cambia a columna para centrar contenido interno */

  align-items: center; /* Centra el contenido interno horizontalmente */

  justify-content: center; /* Centra el contenido interno verticalmente */

  max-width: 300px; /* Define un ancho máximo para los elementos */

  margin: 0 auto; /* Esto ayuda a centrar el elemento si tiene un ancho fijo */

}

.stats-icon {

  width: 3rem;

  height: 3rem;

  border-radius: 0.5rem;

  display: flex;

  align-items: center;

  justify-content: center;

}

.stats-icon i {

  font-size: 1.5rem;

  color: white;

}

.bg-primary {

  background-color: var(--primary);

}

.bg-secondary-green {

  background-color: var(--secondary-green);

}

.bg-accent-orange {

  background-color: var(--accent-orange);

}

.bg-purple {

  background-color: var(--purple);

}

.stats-content {

  flex: 1;

 

}

.stats-title {

  font-size: 0.875rem;

  font-weight: 500;

  color: var(--neutral-600);

  margin-bottom: 0.25rem;

}

.stats-value {

  font-size: 1.5rem;

  font-weight: 700;

  color: var(--neutral-800);

}

/* Certificates Grid */

.certificates-grid {

  display: grid;

  grid-template-columns: repeat(1, minmax(0, 1fr));

  gap: 1.5rem;

  margin-bottom: 3rem;

}

@media (min-width: 768px) {

  .certificates-grid {

    grid-template-columns: repeat(2, minmax(0, 1fr));

  }

}

@media (min-width: 1024px) {

  .certificates-grid {

    grid-template-columns: repeat(3, minmax(0, 1fr));

  }

}

.certificate-card {

  border: 1px solid var(--neutral-200);

  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);

  border-radius: 0.5rem;

  background: white;

  overflow: hidden;

  transition: box-shadow 0.2s;

}

.certificate-card:hover {

  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);

}

.certificate-thumbnail {

  position: relative;

  height: 8rem;

  width: 100%;

}

.certificate-thumbnail img {

  width: 100%;

  height: 100%;

  object-fit: cover;

}

.certificate-body {

  padding: 1.5rem;

}

.certificate-header-content {

  display: flex;

  align-items: center;

  justify-content: space-between;

  margin-bottom: 1rem;

}

.certificate-icon-wrapper {

  padding: 0.5rem;

  background-color: var(--primary);

  background-opacity: 0.1;

  border-radius: 0.5rem;

}

.certificate-icon-wrapper i {

  color: var(--primary);

  font-size: 1.125rem;

}

.badge {

  background-color: var(--secondary-green);

  background-opacity: 0.1;

  color: white;

  padding: 0.25rem 0.5rem;

  border-radius: 0.25rem;

  font-size: 0.75rem;

  font-weight: 500;

}

.certificate-title {

  font-size: 1.125rem;

  font-weight: 600;

  color: var(--neutral-800);

  margin-bottom: 0.5rem;

}

.certificate-description {

  font-size: 0.875rem;

  color: var(--neutral-600);

  margin-bottom: 1rem;

}

.certificate-meta {

  display: flex;

  align-items: center;

  justify-content: space-between;

  font-size: 0.875rem;

  color: var(--neutral-500);

  margin-bottom: 1rem;

}

.certificate-actions {

  display: flex;

  gap: 0.5rem;

}

/* Buttons */

.btn {

  display: inline-flex;

  align-items: center;

  justify-content: center;

  gap: 0.5rem;

  padding: 0.5rem 1rem;

  border-radius: 0.375rem;

  font-size: 0.875rem;

  font-weight: 600;

  border: 1px solid transparent;

  cursor: pointer;

  transition: all 0.2s;

  text-decoration: none;

  background: transparent;

}

.btn-primary {

  background-color: var(--primary);

  color: black;

  flex: 1;

}

.btn-primary:hover {

  background-color: var(--primary);

  opacity: 0.9;

  transform: translateY(-1px);

}

.btn-outline {

  border: 1px solid var(--neutral-200);

  color: var(--neutral-800);

}

.btn-outline:hover {

  background-color: var(--neutral-50);

}

.btn-outline img {

  height: 1.5rem;

  width: 1.5rem;

}

/* Verifier Styles */

.verifier-container {

  max-width: 64rem;

  margin: 0 auto;

}

.verifier-header {

  text-align: center;

  margin-bottom: 2rem;

}

.verifier-icon {

  margin: 0 auto;

  width: 4rem;

  height: 4rem;

  background-color: var(--primary);

  background-opacity: 0.1;

  border-radius: 50%;

  display: flex;

  align-items: center;

  justify-content: center;

  margin-bottom: 1rem;

}

.verifier-icon i {

  color: var(--primary);

  font-size: 1.5rem;

}

.verifier-header h1 {

  font-size: 1.875rem;

  font-weight: 700;

  color: var(--neutral-800);

  margin-bottom: 0.5rem;

}

.verifier-header p {

  color: var(--neutral-600);

  max-width: 32rem;

  margin: 0 auto;

}

.verification-card {

  margin-bottom: 2rem;

}

.card {

  background: white;

  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);

  border: 1px solid var(--neutral-200);

  border-radius: 0.5rem;

}

.card-header {

  padding: 1.5rem;

  border-bottom: 1px solid var(--neutral-200);

}

.card-header h2,

.card-header h3 {

  font-size: 1.25rem;

  font-weight: 600;

  color: var(--neutral-800);

}

.card-content {

  padding: 2rem;

}

.verify-form-container {

  max-width: 24rem;

  margin: 0 auto;

}

.verify-form-container label {

  font-size: 0.875rem;

  font-weight: 500;

  color: var(--neutral-700);

  margin-bottom: 0.75rem;

  display: block;

}

.verify-input-group {

  display: flex;

  gap: 0.75rem;

}

.verify-input {

  flex: 1;

  border: 1px solid var(--neutral-200);

  border-radius: 0.375rem;

  padding: 0.75rem 1rem;

  text-align: center;

  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;

  font-size: 0.875rem;

}

.verify-input:focus {

  outline: none;

  border-color: var(--primary);

  box-shadow: 0 0 0 3px var(--primary);

  box-shadow-opacity: 0.1;

}

.verify-hint {

  font-size: 0.75rem;

  color: var(--neutral-500);

  margin-top: 0.5rem;

  text-align: center;

}

.verify-btn-spinner {

  display: none;

}

.verify-btn-spinner.active {

  display: block;

}

.verify-btn-text.hidden {

  display: none;

}

/* Verification Result */

.verification-result {

  background: white;

  border: 1px solid var(--neutral-200);

  border-radius: 0.5rem;

  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);

  padding: 2rem;

}

.verification-success {

  text-align: center;

  margin-bottom: 1.5rem;

}

.verification-success .verification-icon {

  margin: 0 auto;

  width: 4rem;

  height: 4rem;

  background-color: var(--secondary-green);

  background-opacity: 0.1;

  border-radius: 50%;

  display: flex;

  align-items: center;

  justify-content: center;

  margin-bottom: 1rem;

}

.verification-success .verification-icon i {

  color: white;

  font-size: 1.5rem;

}

.verification-success h2 {

  font-size: 1.25rem;

  font-weight: 600;

  color: var(--neutral-800);

}

.verification-success p {

  color: var(--neutral-600);

  margin-top: 0.5rem;

}

.certificate-details {

  max-width: 32rem;

  margin: 0 auto;

}

.certificate-preview {

  background: #FCD307;

  background-opacity: 0.05;

  border-radius: 0.5rem;

  padding: 1.5rem;

  border: 1px solid var(--primary);

  border-opacity: 0.1;

}

.certificate-preview-header {

  display: flex;

  align-items: center;

  justify-content: space-between;

  margin-bottom: 1rem;

}

.certificate-preview-user {

  display: flex;

  align-items: center;

  gap: 0.75rem;

}

.certificate-preview-avatar {

  width: 3rem;

  height: 3rem;

  background: white;

  border-radius: 50%;

  display: flex;

  align-items: center;

  justify-content: center;

  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);

}

.certificate-preview-avatar i {

  color: var(--primary);

  font-size: 1.125rem;

}

.certificate-preview-info h3 {

  font-weight: 600;

  color: var(--neutral-800);

  font-size: 1rem;

}

.certificate-preview-info p {

  font-size: 0.875rem;

  color: var(--neutral-600);

}

.certificate-data {

  display: grid;

  gap: 1rem;

  margin-top: 1rem;

}

.data-row {

  display: flex;

  justify-content: space-between;

  padding: 0.75rem 0;

  border-bottom: 1px solid var(--neutral-200);

}

.data-label {

  font-weight: 500;

  color: var(--neutral-600);

  font-size: 0.875rem;

}

.data-value {

  color: var(--neutral-800);

  font-weight: 500;

  font-size: 0.875rem;

}

/* Admin Styles */

.tabs {

  margin-top: 2rem;

}

.tabs-list {

  display: flex;

  border-bottom: 1px solid var(--neutral-200);

  margin-bottom: 2rem;

}

.tab-trigger {

  padding: 0.75rem 1.5rem;

  border: none;

  background: transparent;

  color: var(--neutral-600);

  font-weight: 500;

  cursor: pointer;

  border-bottom: 2px solid transparent;

  transition: all 0.2s;

}

.tab-trigger:hover {

  color: var(--neutral-800);

}

.tab-trigger.active {

  color: var(--primary);

  border-bottom-color: var(--primary);

}

.tab-content {

  display: none;

}

.tab-content.active {

  display: block;

}

.tab-header {

  display: flex;

  justify-content: space-between;

  align-items: center;

  margin-bottom: 1.5rem;

  gap: 1rem;

}

.search-container {

  position: relative;

  flex: 1;

  max-width: 20rem;

}

.search-container i {

  position: absolute;

  left: 0.75rem;

  top: 50%;

  transform: translateY(-50%);

  color: var(--neutral-400);

}

.search-container input {

  width: 100%;

  padding: 0.5rem 0.75rem 0.5rem 2.5rem;

  border: 1px solid var(--neutral-200);

  border-radius: 0.375rem;

  font-size: 0.875rem;

}

.search-container input:focus {

  outline: none;

  border-color: var(--primary);

}

/* Profile Section */

.profile-section {

  margin-top: 3rem;

}

.form-grid {

  display: grid;

  grid-template-columns: repeat(1, minmax(0, 1fr));

  gap: 1.5rem;

  margin-bottom: 1.5rem;

}

@media (min-width: 768px) {

  .form-grid {

    grid-template-columns: repeat(2, minmax(0, 1fr));

  }

}

.form-group {

  display: flex;

  flex-direction: column;

}

.form-group label {

  font-size: 0.875rem;

  font-weight: 500;

  color: var(--neutral-700);

  margin-bottom: 0.5rem;

}

.form-group input {

  border: 1px solid var(--neutral-200);

  border-radius: 0.375rem;

  padding: 0.5rem 0.75rem;

  font-size: 0.875rem;

}

.form-group input:focus {

  outline: none;

  border-color: var(--primary);

}

/* Import Styles */

.import-container {

  max-width: 32rem;

  margin: 0 auto;

}

.file-upload-area {

  border: 2px dashed var(--neutral-200);

  border-radius: 0.5rem;

  padding: 3rem 2rem;

  text-align: center;

  cursor: pointer;

  transition: all 0.2s;

  margin-bottom: 1rem;

}

.file-upload-area:hover {

  border-color: var(--primary);

  background-color: var(--primary);

  background-opacity: 0.05;

}

.file-upload-area i {

  font-size: 3rem;

  color: var(--neutral-400);

  margin-bottom: 1rem;

}

.file-upload-area h4 {

  font-size: 1.125rem;

  font-weight: 600;

  color: var(--neutral-800);

  margin-bottom: 0.5rem;

}

.file-upload-area p {

  color: var(--neutral-600);

}

.file-info {

  display: flex;

  align-items: center;

  gap: 0.75rem;

  padding: 0.75rem;

  background-color: var(--neutral-50);

  border-radius: 0.375rem;

  margin-bottom: 1rem;

}

.file-info i {

  color: var(--secondary-green);

  font-size: 1.25rem;

}

.file-info span {

  flex: 1;

  font-weight: 500;

  color: var(--neutral-800);

}

.form-actions {

  display: flex;

  justify-content: flex-end;

  gap: 0.5rem;

  margin-top: 1.5rem;

}

#course-form-container {

  margin-top: 1.5rem;

}

#course-form textarea {

  width: 100%;

  min-height: 100px;

  border: 1px solid var(--neutral-200);

  border-radius: 0.375rem;

  padding: 0.5rem 0.75rem;

  font-size: 0.875rem;

  resize: vertical;

}

.btn-linkedin {

  background-color: rgb(255, 255, 255);

  color: rgb(0, 0, 0);

  border: 2px solid black; /* Esto añade un borde negro de 2 píxeles */

  border-radius: 4px;

  padding: 8px 12px;

  margin-left: 10px;

  cursor: pointer;

  display: inline-flex;

  align-items: center;

  justify-content: center;

}

.btn-linkedin:hover {

  background-color: #005582;

  border: 2px solid #005582; /* Cambia el color del borde al pasar el ratón */

  color: white;

}

.file-info button {

  background: none;

  border: none;

  color: var(--neutral-400);

  cursor: pointer;

  padding: 0.25rem;

}

.file-info button:hover {

  color: var(--neutral-600);

}

/* Mobile Navigation */

/* Estilos generales para el mobile-nav */

.mobile-nav {

  display: flex;

  justify-content: space-around;

  position: fixed;

  bottom: 0;

  left: 0;

  right: 0;

  background: white;

  border-top: 1px solid var(--neutral-200);

  padding: 0.75rem;

  z-index: 50;

}

/* Ocultar mobile-nav en pantallas grandes */

@media (min-width: 768px) {

  .mobile-nav {

    display: none !important; /* Usar !important temporalmente para pruebas */

  }

}

.mobile-nav {

  display: flex;

  justify-content: space-around;

}

.mobile-nav-btn {

  display: flex;

  flex-direction: column;

  align-items: center;

  gap: 0.25rem;

  padding: 0.5rem;

  background: transparent;

  border: none;

  cursor: pointer;

  color: var(--neutral-600);

  font-size: 0.75rem;

}

.mobile-nav-btn.active {

  color: var(--primary);

}

.mobile-nav-btn i {

  font-size: 1.25rem;

}

/* Loading */

.loading {

  position: fixed;

  top: 0;

  left: 0;

  width: 100%;

  height: 100%;

  background: rgba(255, 255, 255, 0.8);

  display: flex;

  justify-content: center;

  align-items: center;

  z-index: 100;

}

.spinner {

  width: 2rem;

  height: 2rem;

  border: 2px solid var(--neutral-200);

  border-top: 2px solid var(--primary);

  border-radius: 50%;

  animation: spin 1s linear infinite;

}

.spinner-small {

  width: 1rem;

  height: 1rem;

  border: 2px solid transparent;

  border-top: 2px solid white;

  border-radius: 50%;

  animation: spin 1s linear infinite;

}

/* Modal para usuarios del curso */

.course-users-modal {

  position: fixed;

  top: 0;

  left: 0;

  width: 100%;

  height: 100%;

  background-color: rgba(0, 0, 0, 0.5);

  display: flex;

  justify-content: center;

  align-items: center;

  z-index: 1000;

}

.course-users-modal-content {

  background-color: white;

  padding: 1.5rem;

  border-radius: 0.5rem;

  width: 90%;

  max-width: 400px;

  max-height: 80vh;

  overflow-y: auto;

}

.course-users-modal-header {

  display: flex;

  justify-content: space-between;

  align-items: center;

  margin-bottom: 1rem;

}

.course-users-modal-header h3 {

  font-size: 1.125rem;

  font-weight: 600;

  color: var(--neutral-800);

}

.course-users-modal-close {

  background: none;

  border: none;

  font-size: 1.25rem;

  cursor: pointer;

  color: var(--neutral-600);

}

.course-users-list {

  list-style: none;

}

.course-users-list li {

  padding: 0.5rem 0;

  border-bottom: 1px solid var(--neutral-200);

  font-size: 0.875rem;

  color: var(--neutral-800);

}

.btn-users-count {

  background-color: var(--secondary-green);

  color: white;

  border: none;

  border-radius: 20px;

  padding: 0.25rem 0.75rem;

  font-size: 0.875rem;

  font-weight: 600;

  cursor: pointer;

  transition: opacity 0.2s;

}

.btn-users-count:hover {

  opacity: 0.9;

}

@keyframes spin {

  0% { transform: rotate(0deg); }

  100% { transform: rotate(360deg); }

}

/* Toast Notifications */

#toast-container {

  position: fixed;

  top: 55%; /* Centra verticalmente */

  left: 47%; /* Centra horizontalmente */

  transform: translate(-20%, -50%); /* Ajusta la posición para que sea exacta */

  z-index: 100;

  display: flex;

  flex-direction: column;

  gap: 0.5rem;

  align-items: center; /* Centra los toasts dentro del contenedor */

  width: 130%; /* Opcional: asegura que el contenedor ocupe el ancho completo */

  

}

.toast {

  background: white;

  border: 1px solid var(--neutral-200);

  border-radius: 0.375rem;

  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);

  padding: 0.75rem;

  min-width: 16rem;

  max-width: 20rem;

  margin: 0 auto; /* Centra cada toast dentro del contenedor */

    animation: slideInLeft 0.5s cubic-bezier(0.25, 0.1, 0.25, 1) forwards; /* Duración y timing más suave */

}

.toast.success {

  border-left: 4px solid var(--secondary-green);

}

.toast.error {

  border-left: 4px solid var(--destructive);

}

.toast-header {

  display: flex;

  align-items: center;

  gap: 0.5rem;

  margin-bottom: 0.25rem;

}

.toast-header i {

  font-size: 1rem; /* Reducido de 1.125rem */

}

.toast.success .toast-header i {

  color: var(--secondary-green);

}

.toast.error .toast-header i {

  color: var(--destructive);

}

.toast-title {

  font-weight: 600;

  color: var(--neutral-800);

  font-size: 0.875rem; /* Reducido de 1rem */

}

.toast-description {

  color: var(--neutral-600);

  font-size: 0.75rem; /* Reducido de 0.875rem */

  margin: 0; /* Eliminado el margen */

}

@keyframes slideInLeft {

  from {

    transform: translateX(100%);

    opacity: 0;

  }

  to {

    transform: translateX(0%);

    opacity: 1;

  }

}

/* Dialog Styles */

#dialog-container {

  display: none;

  position: fixed;

  top: 0;

  left: 0;

  width: 100%;

  height: 100%;

  z-index: 200;

}

.dialog-overlay {

  position: absolute;

  top: 0;

  left: 0;

  width: 100%;

  height: 100%;

  background: rgba(0, 0, 0, 0.5);

  display: flex;

  align-items: center;

  justify-content: center;

  padding: 1rem;

}

.dialog {

  background: white;

  border-radius: 0.5rem;

  box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);

  max-width: 32rem;

  width: 100%;

  max-height: 90vh;

  overflow-y: auto;

}

.dialog-header {

  display: flex;

  align-items: center;

  justify-content: space-between;

  padding: 1.5rem;

  border-bottom: 1px solid var(--neutral-200);

}

.dialog-header h3 {

  font-size: 1.125rem;

  font-weight: 600;

  color: var(--neutral-800);

}

.dialog-close {

  background: none;

  border: none;

  color: var(--neutral-400);

  cursor: pointer;

  padding: 0.25rem;

  border-radius: 0.25rem;

  transition: color 0.2s;

}

.dialog-close:hover {

  color: var(--neutral-600);

}

.dialog-content {

  padding: 1.5rem;

}

.dialog select {

  width: 100%;

  border: 1px solid var(--neutral-200);

  border-radius: 0.375rem;

  padding: 0.5rem 0.75rem;

  font-size: 0.875rem;

  background: white;

}

.dialog select:focus {

  outline: none;

  border-color: var(--primary);

}

/* Utility Classes */

.hidden {

  display: none !important;

}

.text-center {

  text-align: center;

}

/* Responsive Adjustments */

@media (max-width: 767px) {

  .user-info {

    display: none;

  }

  

  .tab-header {

    flex-direction: column;

    align-items: stretch;

  }

  

  .search-container {

    max-width: none;

  }

}

/* ===== Ajustes mínimos para móviles ===== */

@media (max-width: 767px) {

  /* Navegación */

  .nav-buttons {

    display: none !important;

  }

  .user-info {

    display: none !important;

  }

  .mobile-nav {

    display: flex !important;

  }

  .mobile-nav-btn {

    flex: 1;

    padding: 0.5rem 0;

    font-size: 0.7rem;

  }

  .mobile-nav-btn i {

    font-size: 1.3rem;

    margin-bottom: 0.2rem;

  }

  /* Stats Grid */

  .stats-grid {

    grid-template-columns: repeat(1, 1fr) !important;

    gap: 1rem !important;

  }

  /* Certificates Grid */

  .certificates-grid {

    grid-template-columns: repeat(1, 1fr) !important;

    gap: 1rem !important;

  }

  /* Tablas */

  table {

    width: 100% !important;

    display: block !important;

    overflow-x: auto !important;

  }

  /* Formularios */

  .form-group input,

  .form-group select,

  .form-group textarea {

    width: 100% !important;

  }

  /* Verifier View */

  .verify-input-group {

    flex-direction: column !important;

  }

  .verify-input {

    width: 100% !important;

    margin-bottom: 0.5rem !important;

  }

  .btn-primary {

    width: 100% !important;

  }

  /* File Upload */

  .file-upload-area {

    padding: 2rem !important;

  }

}

/* ===== Ajustes para móviles: Icono de usuario y logout ===== */

@media (max-width: 767px) {

  /* Header */

  .header-container {

    padding: 0 0.5rem !important;

  }

  /* Ocultar nav-buttons y mostrar mobile-nav */

  .nav-buttons {

    display: none !important;

  }

  /* Mostrar user-info en móviles, pero compacto */

  .user-info {

    display: flex !important;

    align-items: center;

    gap: 0.5rem;

    margin-left: auto;

  }

  /* Ajustar el tamaño del icono y nombre de usuario */

  .user-info i {

    font-size: 1.2rem !important;

  }

  /* Ajustar el user-info para mostrar el nombre completo */

  .user-info span {

    font-size: 0.75rem !important;

    max-width: 150px !important; /* Aumentar el ancho máximo */

    white-space: nowrap !important;

    overflow: visible !important; /* Permitir que el texto desborde si es necesario */

    text-overflow: clip !important; /* No mostrar "..." */

  }

  /* Botón de logout en móviles */

  .logout-btn {

    padding: 0.9rem 0.5rem !important;

    font-size: 0.7rem !important;

    margin-left: 2rem !important;

  }

  /* Mobile nav */

  .mobile-nav {

    display: flex !important;

    justify-content: space-around;

    position: fixed;

    bottom: 0;

    left: 0;

    right: 0;

    background: white;

    border-top: 1px solid var(--neutral-200);

    padding: 0.5rem 0;

    z-index: 50;

  }

  /* Logo en móviles */

  .logo span {

    font-size: 1rem !important;

  }

}



prueba.js

// Variables globales

let coursesCache = JSON.parse(localStorage.getItem('coursesCache')) || [];

let certificatesCache = [];

let usersCache = JSON.parse(localStorage.getItem('usersCache')) || [];

let adminStatsCache = {};

let adminCertificatesCache = [];

let currentView = 'graduate';

let currentCourseId = null;

let currentImageFile = null;

let currentUserId = null;

// Función para cerrar sesión

function logout() {

  auth.signOut().then(() => {

    localStorage.removeItem('userRole');

    localStorage.removeItem('userName');

    window.location.href = 'login.html';

  }).catch((error) => {

    console.error("Error al cerrar sesión:", error);

  });

}

// Función para cargar usuarios desde Firestore

async function loadUsers() {

  try {

    const usersSnapshot = await dbUsers.collection('users').get();

    usersCache = usersSnapshot.docs.map(doc => ({

      id: doc.id,

      ...doc.data()

    }));

    console.log("Usuarios cargados desde Firestore:", usersCache);

  } catch (error) {

    console.error("Error al cargar usuarios desde Firestore:", error);

    usersCache = [];

  }

}

// Función para guardar los cursos en localStorage

function saveCoursesToLocalStorage() {

  localStorage.setItem('coursesCache', JSON.stringify(coursesCache));

}

// Función para cargar los cursos desde localStorage

function loadCoursesFromLocalStorage() {

  const savedCourses = localStorage.getItem('coursesCache');

  if (savedCourses) {

    coursesCache = JSON.parse(savedCourses);

  }

}

// Función para generar un ID único

function generateUniqueId() {

  return 'WS-' + Date.now() + '-' + Math.floor(Math.random() * 1000);

}

// Función para generar un hash

async function generateHash(input) {

  const encoder = new TextEncoder();

  const data = encoder.encode(input);

  const hashBuffer = await crypto.subtle.digest('SHA-256', data);

  const hashArray = Array.from(new Uint8Array(hashBuffer));

  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

  return hashHex;

}

// Función para guardar información del certificado en Firestore

async function saveCertificateToFirestore(id, nombre, curso, fecha, hashHex) {

  try {

    const fechaActual = new Date().toISOString().split('T')[0];

    await dbCertificates.collection('certificates').add({

      id: id,

      nombre: nombre,

      curso: curso,

      fecha: fechaActual,

      hash: hashHex,

      createdAt: firebase.firestore.FieldValue.serverTimestamp()

    });

    console.log("Certificado guardado con éxito en Firestore");

  } catch (error) {

    console.error("Error al guardar el certificado en Firestore:", error);

    if (error.code === "permission-denied") {

      alert("No tienes permisos para guardar el certificado. Por favor, contacta al administrador.");

    } else {

      alert("Error al guardar el certificado. Por favor, inténtalo de nuevo más tarde.");

    }

  }

}

// Función para generar el enlace del código QR

function generateQRCodeLink(id) {

  return 'https://static.wixstatic.com/media/a687f1_d41ce5e63188472fbf07f5d14db3c63e~mv2.png';

}

// Función para generar PDF individual

async function generarPDFIndividual(nombre, curso, fecha, id, hashHex) {

  const { jsPDF } = window.jspdf;

  const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'A4' });

  const robotoRegularUrl = 'https://cdnjs.cloudflare.com/ajax/libs/ink/3.1.10/fonts/Roboto/roboto-regular-webfont.ttf';

  const robotoBoldUrl = 'https://cdnjs.cloudflare.com/ajax/libs/ink/3.1.10/fonts/Roboto/roboto-bold-webfont.ttf';

  const loadAndRegisterFont = async (url, fontName, fontStyle) => {

    const response = await fetch(url);

    const fontData = await response.arrayBuffer();

    

    const base64Font = btoa(

      new Uint8Array(fontData).reduce(

        (data, byte) => data + String.fromCharCode(byte),

        ''

      )

    );

    doc.addFileToVFS(`${fontName}.ttf`, base64Font);

    doc.addFont(`${fontName}.ttf`, fontName, fontStyle);

  };

  

  const loadImage = (src) => {

    return new Promise((resolve, reject) => {

      const img = new Image();

      img.crossOrigin = "Anonymous";

      img.onload = () => resolve(img);

      img.onerror = reject;

      img.src = src;

    });

  };

  try {

    await loadAndRegisterFont(robotoRegularUrl, 'Roboto', 'normal');

    await loadAndRegisterFont(robotoBoldUrl, 'Roboto', 'bold');

    const fondoURL = 'https://static.wixstatic.com/media/a687f1_6daa751a4aac4a418038ae37f20db004~mv2.jpg';

    const fondo = await loadImage(fondoURL);

    const qrUrl = generateQRCodeLink(id);

    const qrImage = await loadImage(qrUrl);

    doc.addImage(fondo, 'JPEG', 0, 0, 850, 595);

    doc.setFont('Roboto', 'bold');

    doc.setFontSize(37);

    doc.setTextColor(0, 0, 0);

    doc.text(`${curso}`, 425, 130, { align: 'center' });

    doc.setFont('Roboto', 'bold');

    doc.setFontSize(35);

    doc.setTextColor(255, 255, 255);

    doc.text(`${nombre}`, 425, 190, { align: 'center' });

    doc.setFont('Roboto', 'normal');

    doc.setFontSize(14);

    doc.setTextColor(0, 0, 0);

    const text = "WeSpark certifies that you have completed our future-ready learning experience designed to build practical";

    doc.text(doc.splitTextToSize(text, 700), 80, 250);

    const text1 = "skills for real-world impact. This certificate celebrates your participation in our interactive, innovation-focused";

    doc.text(doc.splitTextToSize(text1, 700), 80, 270);

    doc.text("training. Now go out there and release your inner genius!", 260, 290);

    const fechaActual = new Date();

    const dia = String(fechaActual.getDate()).padStart(2, '0');

    const mes = String(fechaActual.getMonth() + 1).padStart(2, '0');

    const anio = fechaActual.getFullYear();

    const fechaFormateada = `${dia}.${mes}.${anio}`;

    doc.setFont('Roboto', 'bold');

    doc.setFontSize(13);

    doc.setTextColor(255, 255, 255);

    doc.text(`San Salvador, ${fechaFormateada}`, 340, 320);

    doc.setFont('Roboto', 'normal');

    doc.setFontSize(10);

    doc.setTextColor(0, 0, 0);

    doc.text(`ID: ${id}`, 4, 15);

    doc.text(`Hash: ${hashHex}`, 263, 585);

    doc.addImage(qrImage, 'PNG', 124, 460, 100, 100);

    return doc.output('blob');

  } catch (error) {

    console.error("Error al generar PDF:", error);

    alert(`⚠️ Error al generar el PDF para ${nombre}`);

    throw error;

  }

}

// Función para descargar certificado

async function downloadCertificate(certificateId) {

  showLoading();

  try {

    const certificate = certificatesCache.find(cert => cert.id == certificateId);

    if (!certificate) throw new Error('Certificate not found');

    const id = generateUniqueId();

    const hashHex = await generateHash(id);

    const userName = localStorage.getItem('userName') || certificate.nombre;

    const pdfBlob = await generarPDFIndividual(userName, certificate.course.title, certificate.completionDate, id, hashHex);

    await saveCertificateToFirestore(id, userName, certificate.course.title, certificate.completionDate, hashHex);

    const pdfUrl = URL.createObjectURL(pdfBlob);

    window.open(pdfUrl, '_blank');

    showToast('success', 'Certificate Ready', 'Your certificate is open in a new tab. Download it from there.');

  } catch (error) {

    console.error('Download error:', error);

    showToast('error', 'Download Failed', 'Failed to generate certificate. Please try again.');

  } finally {

    hideLoading();

  }

}

// Función para agregar curso

function addCourse() {

  currentCourseId = null;

  currentImageFile = null;

  document.getElementById('course-form-title').textContent = 'Add Course';

  document.getElementById('course-form').reset();

  document.getElementById('course-image-preview').style.display = 'none';

  document.getElementById('course-form-container').classList.remove('hidden');

  loadUsersIntoCourseForm();

}

// Función para editar curso

function editCourse(courseId) {

  const course = coursesCache.find(c => c.id === courseId);

  if (course) {

    currentCourseId = courseId;

    currentImageFile = null;

    document.getElementById('course-form-title').textContent = 'Edit Course';

    document.getElementById('course-title').value = course.title;

    document.getElementById('course-description').value = course.description;

    document.getElementById('course-duration').value = course.duration;

    const savedImageUrl = localStorage.getItem(`courseImage_${courseId}`);

    if (savedImageUrl) {

      document.getElementById('course-image-preview').src = savedImageUrl;

      document.getElementById('course-image-preview').style.display = 'block';

    } else {

      document.getElementById('course-image-preview').style.display = 'none';

    }

    loadUsersIntoCourseForm();

    if (course.users) {

      course.users.forEach(userId => {

        const checkbox = document.querySelector(`#course-users-checkboxes input[value="${userId}"]`);

        if (checkbox) checkbox.checked = true;

      });

    }

    document.getElementById('course-form-container').classList.remove('hidden');

  }

}

async function uploadImage(file) {

  return new Promise((resolve) => {

    const reader = new FileReader();

    reader.onload = (e) => {

      const base64Image = e.target.result;

      resolve(base64Image);

    };

    reader.readAsDataURL(file);

  });

}

// Función para eliminar curso

function deleteCourse(courseId) {

  localStorage.removeItem(`courseImage_${courseId}`);

  coursesCache = coursesCache.filter(course => course.id !== courseId);

  saveCoursesToLocalStorage();

  displayCoursesTable();

}

// Función para mostrar formulario de usuario

function showUserForm(userId = null) {

  currentUserId = userId;

  const formTitle = document.getElementById('user-form-title');

  const formContainer = document.getElementById('user-form-container');

  const form = document.getElementById('user-form');

  if (!form || !formContainer) {

    console.error("El formulario de usuarios no se encontró en el DOM.");

    return;

  }

  form.reset();

  if (userId !== null) {

    const user = usersCache.find(u => u.id === userId);

    if (user) {

      const nameInput = form.querySelector('#user-name');

      const emailInput = form.querySelector('#user-email');

      const roleInput = form.querySelector('#user-role');

      if (nameInput && emailInput && roleInput) {

        nameInput.value = user.name || '';

        emailInput.value = user.email || '';

        roleInput.value = user.role || 'graduate';

      }

      formTitle.textContent = 'Edit User';

    } else {

      console.error(`User with ID ${userId} not found.`);

      showToast('error', 'User Not Found', 'The user you are trying to edit does not exist.');

      return;

    }

  } else {

    formTitle.textContent = 'Add User';

  }

  formContainer.classList.remove('hidden');

  form.onsubmit = function(e) {

    e.preventDefault();

    const nameInput = form.querySelector('#user-name');

    const emailInput = form.querySelector('#user-email');

    const roleInput = form.querySelector('#user-role');

    if (!nameInput || !emailInput || !roleInput) {

      console.error("Uno o más elementos del formulario no se encontraron.");

      showToast('error', 'Form Error', 'Form elements not found.');

      return;

    }

    const name = nameInput.value;

    const email = emailInput.value;

    const role = roleInput.value;

    if (!name || !email) {

      showToast('error', 'Invalid Data', 'Name and email are required.');

      return;

    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (!emailRegex.test(email)) {

      showToast('error', 'Invalid Email', 'Please enter a valid email address.');

      return;

    }

    if (currentUserId !== null) {

      usersCache = usersCache.map(user => {

        if (user.id === currentUserId) {

          return { id: currentUserId, name: name.trim(), email: email.trim(), role };

        }

        return user;

      });

    } else {

      const newId = usersCache.length > 0 ? Math.max(...usersCache.map(u => u.id)) + 1 : 1;

      usersCache.push({ id: newId, name: name.trim(), email: email.trim(), role, createdAt: new Date().toISOString() });

    }

    localStorage.setItem('usersCache', JSON.stringify(usersCache));

    displayUsersTable();

    hideUserForm();

  };

}

// Función para ocultar formulario de usuario

function hideUserForm() {

  document.getElementById('user-form-container').classList.add('hidden');

}

// Función para validar usuarios

function validateUsers() {

  usersCache = usersCache.map(user => {

    if (!user.id) user.id = Math.floor(Math.random() * 1000000);

    if (!user.name) user.name = 'Unknown';

    if (!user.email) user.email = 'unknown@example.com';

    if (!user.role) user.role = 'graduate';

    if (!user.createdAt) user.createdAt = new Date().toISOString();

    return user;

  });

  localStorage.setItem('usersCache', JSON.stringify(usersCache));

}

// Función para cargar usuarios desde localStorage

function loadUsersFromLocalStorage() {

  const savedUsers = localStorage.getItem('usersCache');

  if (savedUsers) {

    usersCache = JSON.parse(savedUsers);

  } else {

    usersCache = [];

  }

  validateUsers();

}

// Función para eliminar usuario

async function deleteUser(userId) {

  const isConfirmed = confirm("Are you sure you want to delete this user? This action cannot be undone.");

  if (!isConfirmed) return;

  try {

    showLoading();

    console.log("Intentando eliminar al usuario con ID:", userId);

    await dbUsers.collection('users').doc(userId).delete();

    showToast('success', 'User Deleted', 'The user has been deleted successfully.');

    usersCache = usersCache.filter(user => user.id !== userId);

    displayUsersTable();

  } catch (error) {

    console.error("Error deleting user:", error);

    showToast('error', 'Error', 'Failed to delete user. Check console for details.');

  } finally {

    hideLoading();

  }

}

// Función para cancelar formulario de curso

function cancelCourseForm() {

  document.getElementById('course-form-container').classList.add('hidden');

}

// Función para mostrar tabla de usuarios

function displayUsersTable(users = usersCache) {

  const container = document.getElementById('users-table-container');

  if (users.length === 0) {

    container.innerHTML = `

      <div class="text-center" style="padding: 2rem;">

        <p>No users found.</p>

      </div>

    `;

    return;

  }

  container.innerHTML = `

    <div style="overflow-x: auto;">

      <table style="width: 100%; border-collapse: collapse;">

        <thead>

          <tr style="border-bottom: 1px solid var(--neutral-200);">

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Name</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Email</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Role</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Created</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Actions</th>

          </tr>

        </thead>

        <tbody>

          ${users.map(user => `

            <tr style="border-bottom: 1px solid var(--neutral-200);">

              <td style="padding: 0.75rem;">${user.name || 'Undefined'}</td>

              <td style="padding: 0.75rem;">${user.email || 'Undefined'}</td>

              <td style="padding: 0.75rem;">

                <span class="badge" style="background-color: ${user.role === 'admin' ? 'var(--purple)' : 'var(--secondary-green)'}; color: white;">

                  ${user.role || 'Undefined'}

                </span>

              </td>

              <td style="padding: 0.75rem;">${user.createdAt ? new Date(user.createdAt.seconds * 1000).toLocaleDateString() : 'Undefined'}</td>

              <td style="padding: 0.75rem;">

                <button class="btn btn-outline" style="padding: 0.25rem 0.5rem; margin-right: 0.5rem;" onclick="showUserForm('${user.id}')">

                  <i class="fas fa-edit"></i>

                </button>

                <button class="btn btn-outline" style="padding: 0.25rem 0.5rem; color: var(--destructive); border-color: var(--destructive);" onclick="showConfirmationToast('${user.id}')">

                  <i class="fas fa-trash"></i>

                </button>

              </td>

            </tr>

          `).join('')}

        </tbody>

      </table>

    </div>

  `;

}

// Función para mostrar tabla de cursos

function displayCoursesTable(courses = coursesCache) {

  const container = document.getElementById('courses-table-container');

  if (courses.length === 0) {

    container.innerHTML = `<div class="text-center" style="padding: 2rem;"><p>No courses found.</p></div>`;

    return;

  }

  container.innerHTML = `

    <div style="overflow-x: auto;">

      <table style="width: 100%; border-collapse: collapse;">

        <thead>

          <tr style="border-bottom: 1px solid var(--neutral-200);">

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Title</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Description</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Duration</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Users</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Image</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Actions</th>

          </tr>

        </thead>

        <tbody>

          ${courses.map(course => {

            const imageSrc = course.image || defaultImageBase64;

            const userCount = course.users ? course.users.length : 0;

            return `

              <tr style="border-bottom: 1px solid var(--neutral-200);">

                <td style="padding: 0.75rem; font-weight: 600;">${course.title}</td>

                <td style="padding: 0.75rem; max-width: 300px;">${course.description}</td>

                <td style="padding: 0.75rem;">${course.duration} hours</td>

                <td style="padding: 0.75rem;">

                  ${userCount > 0 ?

                    `<button class="btn-users-count" onclick="showCourseUsers(${course.id})">${userCount}</button>` :

                    '<span style="color: var(--neutral-600);">None</span>'

                  }

                </td>

                <td style="padding: 0.75rem;">

                  <img

                    src="${imageSrc}"

                    alt="${course.title}"

                    style="width: 50px; height: auto; max-height: 50px;"

                    onerror="this.src='${defaultImageBase64}';"

                  >

                </td>

                <td style="padding: 0.75rem;">

                  <button class="btn btn-outline" style="padding: 0.25rem 0.5rem; margin-right: 0.5rem;" onclick="editCourse(${course.id})">

                    <i class="fas fa-edit"></i>

                  </button>

                  <button class="btn btn-outline" style="padding: 0.25rem 0.5rem; color: var(--destructive); border-color: var(--destructive);" onclick="deleteCourse(${course.id})">

                    <i class="fas fa-trash"></i>

                  </button>

                </td>

              </tr>

            `;

          }).join('')}

        </tbody>

      </table>

    </div>

  `;

}

// Función para eliminar curso

function deleteCourse(courseId) {

  localStorage.removeItem(`courseImage_${courseId}`);

  coursesCache = coursesCache.filter(course => course.id !== courseId);

  saveCoursesToLocalStorage();

  displayCoursesTable();

}

// Función para cargar usuarios en el formulario de cursos

function loadUsersIntoCourseForm() {

  const container = document.getElementById('course-users-checkboxes');

  container.innerHTML = '';

  usersCache.forEach(user => {

    const checkboxItem = document.createElement('div');

    checkboxItem.className = 'checkbox-item';

    const checkbox = document.createElement('input');

    checkbox.type = 'checkbox';

    checkbox.id = `user-${user.id}`;

    checkbox.value = user.id;

    const label = document.createElement('label');

    label.htmlFor = `user-${user.id}`;

    label.textContent = `${user.name} (${user.email})`;

    checkboxItem.appendChild(checkbox);

    checkboxItem.appendChild(label);

    container.appendChild(checkboxItem);

  });

  if (currentCourseId) {

    const course = coursesCache.find(c => c.id === currentCourseId);

    if (course?.users) {

      course.users.forEach(userId => {

        const checkbox = document.querySelector(`#user-${userId}`);

        if (checkbox) checkbox.checked = true;

      });

    }

  }

}

// Función para mostrar los usuarios del curso en un modal

function showCourseUsers(courseId) {

  const course = coursesCache.find(c => c.id === courseId);

  if (!course) return;

  if (!course.users || course.users.length === 0) {

    showToast('warning', 'No Users', 'This course has no participants.');

    return;

  }

  const modal = document.createElement('div');

  modal.className = 'course-users-modal';

  modal.innerHTML = `

    <div class="course-users-modal-content">

      <div class="course-users-modal-header">

        <h3>Participants in ${course.title}</h3>

        <button class="course-users-modal-close" onclick="closeCourseUsersModal(this)">&times;</button>

      </div>

      <ul class="course-users-list">

        ${course.users.map(userId => {

          const user = usersCache.find(u => u.id == userId);

          return `<li>${user ? user.name : 'Unknown User'}</li>`;

        }).join('')}

      </ul>

    </div>

  `;

  document.body.appendChild(modal);

}

// Función para cerrar el modal

function closeCourseUsersModal(button) {

  const modal = button.closest('.course-users-modal');

  if (modal) modal.remove();

}

// Función para migrar imágenes de blob a Base64

async function migrateBlobImagesToBase64() {

  for (const course of coursesCache) {

    if (course.image && course.image.startsWith('blob:')) {

      try {

        const response = await fetch(course.image);

        const blob = await response.blob();

        const reader = new FileReader();

        const base64 = await new Promise((resolve) => {

          reader.onload = () => resolve(reader.result);

          reader.readAsDataURL(blob);

        });

        course.image = base64;

      } catch (error) {

        console.error(`Error migrando imagen del curso ${course.id}:`, error);

        course.image = defaultImageBase64;

      }

    }

  }

  saveCoursesToLocalStorage();

}

// Imagen por defecto en Base64

const defaultImageBase64 = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDUwIDUwIiBmaWxsPSJub25lIiBzdHJva2U9IiNjY2MiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIGZpbGw9IiNmZmYiLz48Y2lyY2xlIGN4PSIyNSIgY3k9IjI1IiByPSIyMCIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjI1IiB5PSIyNSIgZmlsbD0iI2RlZCI+Qy9zdGFnZTwvdGV4dD48L3N2Zz4=";

// Función para mostrar tabla de certificados (admin)

function displayAdminCertificatesTable(certificates = certificatesCache) {

  const container = document.getElementById('certificates-table-container');

  const validCertificates = certificates.filter(cert =>

    cert && cert.id && cert.course && cert.nombre

  );

  if (validCertificates.length === 0) {

    container.innerHTML = `

      <div class="text-center" style="padding: 2rem;">

        <p>No certificates found.</p>

      </div>

    `;

    return;

  }

  container.innerHTML = `

    <div style="overflow-x: auto;">

      <table style="width: 100%; border-collapse: collapse;">

        <thead>

          <tr style="border-bottom: 1px solid var(--neutral-200);">

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Certificate ID</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Student</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Course</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Completion Date</th>

            <th style="text-align: left; padding: 0.75rem; font-weight: 600;">Actions</th>

          </tr>

        </thead>

        <tbody>

          ${validCertificates.map(cert => {

            const course = coursesCache.find(c => c.id === cert.course.id);

            const courseTitle = course ? course.title : 'Unknown Course';

            // Genera la fecha actual en formato local

            const currentDate = new Date().toLocaleDateString();

            return `

              <tr style="border-bottom: 1px solid var(--neutral-200);">

                <td style="padding: 0.75rem; font-family: monospace; font-weight: 600;">WS-${cert.id}</td>

                <td style="padding: 0.75rem;">${localStorage.getItem('userName') || cert.nombre}</td>

                <td style="padding: 0.75rem;">${courseTitle}</td>

                <td style="padding: 0.75rem;">${currentDate}</td> <!-- Fecha actual -->

                <td style="padding: 0.75rem;">

                  <button class="btn btn-outline" style="padding: 0.25rem 0.5rem;" onclick="downloadCertificate(${cert.id})">

                    <i class="fas fa-download"></i>

                  </button>

                </td>

              </tr>

            `;

          }).join('')}

        </tbody>

      </table>

    </div>

  `;

}

// Función para cargar datos de administrador

function loadAdminData() {

  showLoading();

  setTimeout(() => {

    const mockStats = { totalUsers: usersCache.length, totalCourses: coursesCache.length, totalCertificates: 25 };

    adminStatsCache = mockStats;

    updateAdminStats(mockStats);

    displayUsersTable();

    displayCoursesTable();

    displayAdminCertificatesTable();

    hideLoading();

  }, 500);

}

// Función para actualizar estadísticas de administrador

function updateAdminStats() {

  // Calcula el total de certificados según la cantidad en certificatesCache

  const totalCertificates = certificatesCache.length;

  document.getElementById('admin-total-users').textContent = usersCache.length || 0;

  document.getElementById('admin-total-courses').textContent = coursesCache.length || 0;

  document.getElementById('admin-total-certificates').textContent = totalCertificates || 0;

}

// Función para mostrar toast de confirmación

let userIdToDelete = null;

function showConfirmationToast(userId) {

  userIdToDelete = userId;

  const container = document.getElementById('confirmation-toast-container');

  container.innerHTML = '';

  const toast = document.createElement('div');

  toast.className = 'toast warning';

  toast.innerHTML = `

    <div class="toast-header">

      <i class="fas fa-exclamation-triangle"></i>

      <div class="toast-title">Confirm Deletion</div>

    </div>

    <div class="toast-description">Are you sure you want to delete this user? This action cannot be undone.</div>

    <div class="toast-actions">

      <button class="btn btn-outline" id="cancel-delete-toast">Cancel</button>

      <button class="btn btn-primary" id="confirm-delete-toast">Delete</button>

    </div>

  `;

  container.appendChild(toast);

  document.getElementById('cancel-delete-toast').addEventListener('click', () => {

    container.innerHTML = '';

    userIdToDelete = null;

  });

  document.getElementById('confirm-delete-toast').addEventListener('click', async () => {

    container.innerHTML = '';

    if (!userIdToDelete) return;

    try {

      showLoading();

      console.log("Intentando eliminar al usuario con ID:", userIdToDelete);

      await dbUsers.collection('users').doc(userIdToDelete).delete();

      showToast('success', 'User Deleted', 'The user has been deleted successfully.');

      usersCache = usersCache.filter(user => user.id !== userIdToDelete);

      displayUsersTable();

    } catch (error) {

      console.error("Error deleting user:", error);

      showToast('error', 'Error', 'Failed to delete user. Check console for details.');

    } finally {

      hideLoading();

      userIdToDelete = null;

    }

  });

}

// Función para inicializar la aplicación

function initializeApp() {

  auth.onAuthStateChanged(user => {

    if (user) {

      console.log("Usuario autenticado:", user.uid);

      localStorage.setItem('userUID', user.uid);

    } else {

      console.log("No hay usuario autenticado.");

    }

  });

  setupNavigation();

  setupTabs();

  setupFileUpload();

  showView('admin');

  showTab('users');

  const urlParams = new URLSearchParams(window.location.search);

  const uidFromUrl = urlParams.get('uid');

  if (uidFromUrl) {

    localStorage.setItem('userUID', uidFromUrl);

    console.log("UID del usuario desde la URL:", uidFromUrl);

  }

  const userUID = localStorage.getItem('userUID');

  console.log("UID del usuario en localStorage (prueba.js):", userUID);

  if (!userUID) {

    console.error("No se encontró el UID del usuario en localStorage.");

    showToast('error', 'Error', 'No se encontró el UID del usuario. Por favor, inicia sesión de nuevo.');

    setTimeout(() => {

      window.location.href = 'login.html';

    }, 2000);

    return;

  }

  const certificateId = urlParams.get('certificateId');

  if (certificateId) {

    showView('verifier');

    document.getElementById('certificate-id').value = certificateId;

    setTimeout(() => verifyCertificate(), 100);

  }

  const userName = localStorage.getItem('userName');

  const userRole = localStorage.getItem('userRole');

  if (userName) {

    document.querySelector('.user-info span').textContent = userName;

  }

  if (userRole === 'admin') {

    document.querySelectorAll('.nav-btn[data-view="graduate"], .nav-btn[data-view="verifier"], .mobile-nav-btn[data-view="graduate"], .mobile-nav-btn[data-view="verifier"]').forEach(btn => {

      btn.style.display = 'none';

    });

    showView('admin');

  } else if (userRole === 'graduate') {

    document.querySelectorAll('.nav-btn[data-view="admin"], .mobile-nav-btn[data-view="admin"]').forEach(btn => {

      btn.style.display = 'none';

    });

    showView('graduate');

  }

}

// Función para configurar navegación

function setupNavigation() {

  showView('graduate');

}

// Función para mostrar vista

function showView(viewName) {

  currentView = viewName;

  document.querySelectorAll('.view').forEach(view => {

    view.classList.remove('active');

  });

  const targetView = document.getElementById(`${viewName}-view`);

  if (targetView) {

    targetView.classList.add('active');

  }

  document.querySelectorAll('.nav-btn, .mobile-nav-btn').forEach(btn => {

    btn.classList.toggle('active', btn.dataset.view === viewName);

  });

  loadViewData(viewName);

  window.scrollTo(0, 0);

}

// Función para cargar datos de vista

function loadViewData(viewName) {

  switch(viewName) {

    case 'graduate':

      loadGraduateData();

      break;

    case 'verifier':

      break;

    case 'admin':

      loadAdminData();

      break;

  }

}

// Función para cargar datos de graduado

function loadGraduateData() {

  showLoading();

  setTimeout(() => {

    const mockCertificates = coursesCache.map(course => ({

      id: course.id,

      nombre: 'John Doe',

      certificateId: `WS-2025-${course.id.toString().padStart(3, '0')}`,

      completionDate: '2023-01-15',

      course: course

    }));

    certificatesCache = mockCertificates;

    displayCertificates(mockCertificates);

    updateGraduateStats(mockCertificates);

    hideLoading();

  }, 500);

}

// Función para mostrar certificados

function displayCertificates(certificates = certificatesCache) {

  const grid = document.getElementById('certificates-grid');

  if (!certificates || certificates.length === 0) {

    grid.innerHTML = `

      <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">

        <i class="fas fa-tag" style="font-size: 3rem; color: var(--neutral-400); margin-bottom: 1rem;"></i>

        <h3 style="color: var(--neutral-800); margin-bottom: 0.5rem;">No certificates yet</h3>

        <p style="color: var(--neutral-600);">Complete a course to earn your first certificate!</p>

      </div>

    `;

    return;

  }

  grid.innerHTML = certificates.map(cert => createCertificateCard(cert)).join('');

}

// Función para crear tarjeta de certificado

function createCertificateCard(certificate) {

  const completionDate = new Date(certificate.completionDate).toLocaleDateString();

  const courseThumbnail = certificate.course?.image;

  const linkedInUrl = `https://www.linkedin.com/profile/add?startTask=CERTIFICATION_NAME&name=${encodeURIComponent(certificate.course.title)}&organizationId=13993759&issueYear=2025&issueMonth=6&certUrl=https://l3v145431.github.io/Verificate.github.io/&certificateUrl=${encodeURIComponent(window.location.href)}&certificateId=${encodeURIComponent(certificate.id)}`;

  return `

    <div class="certificate-card">

      ${courseThumbnail ? `

        <div class="certificate-thumbnail">

          <img src="${courseThumbnail}" alt="${certificate.course.title}" onerror="this.parentElement.style.display='none'">

        </div>

      ` : ''}

      <div class="certificate-body">

        <div class="certificate-header-content">

          <div class="certificate-icon-wrapper"></div>

          <div class="badge">Completed</div>

        </div>

        <h3 class="certificate-title">${certificate.course.title}</h3>

        <p class="certificate-description">${certificate.course.description}</p>

        <div class="certificate-meta">

          <span>Completed: ${completionDate}</span>

          <span>${certificate.course.duration} hours</span>

        </div>

        <div class="certificate-actions">

          <button class="btn btn-primary" onclick="downloadCertificate(${certificate.id})">

            <i class="fas fa-download"></i> Download PDF

          </button>

          <a href="${linkedInUrl}" target="_blank" class="btn btn-linkedin">

            <i class="fab fa-linkedin"></i> Add to LinkedIn

          </a>

        </div>

      </div>

    </div>

  `;

}

// Función para actualizar estadísticas de graduado

function updateGraduateStats(certificates) {

  const totalCertificates = certificates?.length || 0;

  const totalHours = certificates?.reduce((sum, cert) => sum + cert.course.duration, 0) || 0;

  document.getElementById('total-certificates').textContent = totalCertificates;

  document.getElementById('total-hours').textContent = totalHours;

}

// Función para verificar certificado

// Función para verificar certificado

async function verifyCertificate(certificateId = null) {

  let idToVerify = certificateId;

  if (!idToVerify) {

    idToVerify = document.getElementById('certificate-id').value.trim();

  }

  if (!idToVerify) {

    showToast('error', 'Certificate ID Required', 'Please enter a certificate ID or hash to verify.');

    return;

  }

  const btnText = document.querySelector('.verify-btn-text');

  const btnSpinner = document.querySelector('.verify-btn-spinner');

  if (btnText && btnSpinner) { // Validar que existan

    btnText.classList.add('hidden');

    btnSpinner.classList.add('active');

  }

  try {

    const certificatesRef = dbCertificates.collection('certificates');

    const snapshotById = await certificatesRef.where('id', '==', idToVerify).get();

    const snapshotByHash = await certificatesRef.where('hash', '==', idToVerify).get();

    if (snapshotById.empty && snapshotByHash.empty) {

      displayVerificationError();

      showToast('error', 'Certificate Not Found', 'The certificate ID or hash was not found in our system.');

      return;

    }

    let certificateData;

    if (!snapshotById.empty) {

      snapshotById.forEach(doc => {

        certificateData = doc.data();

      });

    } else {

      snapshotByHash.forEach(doc => {

        certificateData = doc.data();

      });

    }

    displayVerificationResult(certificateData);

    showToast('success', 'Certificate Verified', 'This certificate is valid and authentic.');

  } catch (error) {

    console.error("Error verifying certificate: ", error);

    showToast('error', 'Verification Failed', 'An error occurred while verifying the certificate.');

  } finally {

    if (btnText && btnSpinner) { // Validar que existan

      btnText.classList.remove('hidden');

      btnSpinner.classList.remove('active');

    }

  }

}

// Función para mostrar resultado de verificación

function displayVerificationResult(certificate) {

  const resultContainer = document.getElementById('verification-result');

  const completionDate = certificate.fecha ? new Date(certificate.fecha).toLocaleDateString() : 'N/A';

  resultContainer.innerHTML = `

    <div class="verification-result">

      <div class="verification-success">

        <div class="verification-icon">

          <i class="fas fa-check-circle"></i>

        </div>

        <h2>Certificate Verified</h2>

        <p>This certificate is valid and authentic</p>

      </div>

      <div class="certificate-details">

        <div class="certificate-preview">

          <div class="certificate-preview-header">

            <div class="certificate-preview-user">

              <div class="certificate-preview-avatar">

                <i class="fas fa-graduation-cap"></i>

              </div>

              <div class="certificate-preview-info">

                <h3>${certificate.nombre || 'N/A'}</h3>

                <p>Certificate Holder</p>

              </div>

            </div>

          </div>

          <div class="certificate-data">

            <div class="data-row">

              <span class="data-label">Certificate ID</span>

              <span class="data-value">${certificate.id || 'N/A'}</span>

            </div>

            <div class="data-row">

              <span class="data-label">Course</span>

              <span class="data-value">${certificate.curso || 'N/A'}</span>

            </div>

            <div class="data-row">

              <span class="data-label">Completion Date</span>

              <span class="data-value">${completionDate}</span>

            </div>

            <div class="data-row">

              <span class="data-label">Status</span>

              <span class="data-value" style="color: var(--secondary-green);">

                <i class="fas fa-shield-alt"></i> Verified

              </span>

            </div>

          </div>

        </div>

      </div>

    </div>

  `;

  resultContainer.classList.remove('hidden');

}

// Función para mostrar error de verificación

function displayVerificationError() {

  const resultContainer = document.getElementById('verification-result');

  resultContainer.innerHTML = `

    <div class="verification-result">

      <div class="verification-success">

        <div class="verification-icon" style="background-color: var(--destructive); background-opacity: 0.1;">

          <i class="fas fa-times-circle" style="color: var(--destructive);"></i>

        </div>

        <h2 style="color: var(--destructive);">Certificate Not Found</h2>

        <p>The certificate ID or hash was not found in our system. Please check the ID or hash and try again.</p>

      </div>

    </div>

  `;

  resultContainer.classList.remove('hidden');

}

// Función para configurar pestañas

function setupTabs() {

  document.querySelectorAll('.tab-trigger').forEach(trigger => {

    trigger.addEventListener('click', (e) => {

      const tabName = e.target.dataset.tab;

      showTab(tabName);

    });

  });

}

// Función para mostrar pestaña

function showTab(tabName) {

  document.querySelectorAll('.tab-trigger').forEach(trigger => {

    trigger.classList.toggle('active', trigger.dataset.tab === tabName);

  });

  document.querySelectorAll('.tab-content').forEach(content => {

    content.classList.toggle('active', content.id === `${tabName}-tab`);

  });

  loadTabData(tabName);

}

// Función para cargar datos de pestaña

function loadTabData(tabName) {

  switch(tabName) {

    case 'users':

      displayUsersTable();

      break;

    case 'courses':

      displayCoursesTable();

      break;

    case 'certificates':

      displayAdminCertificatesTable();

      break;

  }

}

// Función para configurar carga de archivos

function setupFileUpload() {

  const uploadArea = document.getElementById('file-upload-area');

  const fileInput = document.getElementById('csv-file');

  const importBtn = document.getElementById('import-btn');

  if (!uploadArea || !fileInput) return;

  uploadArea.addEventListener('click', () => fileInput.click());

  uploadArea.addEventListener('dragover', (e) => {

    e.preventDefault();

    uploadArea.style.borderColor = 'var(--primary)';

  });

  uploadArea.addEventListener('dragleave', () => {

    uploadArea.style.borderColor = 'var(--neutral-200)';

  });

  uploadArea.addEventListener('drop', (e) => {

    e.preventDefault();

    uploadArea.style.borderColor = 'var(--neutral-200)';

    const files = e.dataTransfer.files;

    if (files.length > 0 && files[0].type === 'text/csv') {

      handleFileSelection(files[0]);

    }

  });

  fileInput.addEventListener('change', (e) => {

    if (e.target.files.length > 0) {

      handleFileSelection(e.target.files[0]);

    }

  });

}

// Función para manejar selección de archivo

function handleFileSelection(file) {

  const fileInfo = document.getElementById('file-info');

  const fileName = document.getElementById('file-name');

  const uploadArea = document.getElementById('file-upload-area');

  const importBtn = document.getElementById('import-btn');

  fileName.textContent = file.name;

  uploadArea.style.display = 'none';

  fileInfo.classList.remove('hidden');

  importBtn.disabled = false;

}

// Función para limpiar archivo

function clearFile() {

  const fileInfo = document.getElementById('file-info');

  const uploadArea = document.getElementById('file-upload-area');

  const importBtn = document.getElementById('import-btn');

  const fileInput = document.getElementById('csv-file');

  fileInput.value = '';

  fileInfo.classList.add('hidden');

  uploadArea.style.display = 'block';

  importBtn.disabled = true;

}

// Función para importar CSV

async function importCsv() {

  const fileInput = document.getElementById('csv-file');

  const file = fileInput.files[0];

  if (!file) {

    showToast('error', 'No File Selected', 'Please select a CSV file to import.');

    return;

  }

  showLoading();

  try {

    const results = await new Promise((resolve, reject) => {

      Papa.parse(file, {

        header: true,

        complete: resolve,

        error: reject

      });

    });

    const data = results.data;

    const zip = new JSZip();

    const defaultDate = '2025-07-01';

    for (const row of data) {

      let { nombre, curso, fecha } = row;

      if (!fecha) {

        fecha = defaultDate;

        console.warn(`La fecha no estaba definida para ${nombre}, se asignó la fecha por defecto: ${defaultDate}`);

      }

      const id = generateUniqueId();

      const hashHex = await generateHash(id);

      const pdfBlob = await generarPDFIndividual(nombre, curso, fecha, id, hashHex);

      await saveCertificateToFirestore(id, nombre, curso, fecha, hashHex);

      zip.file(`certificado_${id}.pdf`, pdfBlob);

    }

    const zipBlob = await zip.generateAsync({ type: 'blob' });

    const zipUrl = URL.createObjectURL(zipBlob);

    const a = document.createElement('a');

    a.href = zipUrl;

    a.download = 'certificados.zip';

    document.body.appendChild(a);

    a.click();

    document.body.removeChild(a);

    showToast('success', 'Certificates Generated', 'The certificates have been generated and downloaded successfully.');

  } catch (error) {

    console.error('Error importing CSV:', error);

    showToast('error', 'Import Failed', 'An error occurred while importing the CSV file.');

  } finally {

    hideLoading();

    clearFile();

  }

}

// Función para mostrar loading

function showLoading() {

  document.getElementById('loading').classList.remove('hidden');

}

// Función para ocultar loading

function hideLoading() {

  document.getElementById('loading').classList.add('hidden');

}

// Función para mostrar toast

function showToast(type, title, description = '') {

  const container = document.getElementById('toast-container');

  const toast = document.createElement('div');

  toast.className = `toast ${type}`;

  toast.innerHTML = `

    <div class="toast-header">

      <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>

      <div class="toast-title">${title}</div>

    </div>

    ${description ? `<div class="toast-description">${description}</div>` : ''}

  `;

  container.appendChild(toast);

  setTimeout(() => {

    if (toast.parentNode) {

      toast.parentNode.removeChild(toast);

    }

  }, 5000);

}

// Función para cargar datos iniciales

function loadInitialData() {

  loadGraduateData();

}

// Función para filtrar usuarios según el término de búsqueda

function filterUsersTable(searchTerm) {

  const term = searchTerm.toLowerCase();

  const filteredUsers = usersCache.filter(user =>

    user.name.toLowerCase().includes(term) ||

    user.email.toLowerCase().includes(term) ||

    user.role.toLowerCase().includes(term)

  );

  displayUsersTable(filteredUsers);

}

// Función para filtrar cursos según el término de búsqueda

function filterCoursesTable(searchTerm) {

  const term = searchTerm.toLowerCase();

  const filteredCourses = coursesCache.filter(course =>

    course.title.toLowerCase().includes(term) ||

    course.description.toLowerCase().includes(term) ||

    course.duration.toString().includes(term)

  );

  displayCoursesTable(filteredCourses);

}

function filterCertificatesTable(searchTerm) {

  const term = searchTerm.toLowerCase();

  const filteredCertificates = certificatesCache.filter(cert => {

    // Asegúrate de que el ID del certificado incluya "ws-" al comparar

    const certId = cert.id ? `ws-${String(cert.id).toLowerCase()}` : '';

    const idMatch = certId.includes(term);

    return idMatch;

  });

  displayAdminCertificatesTable(filteredCertificates);

}

// Función para configurar event listeners

function setupEventListeners() {

  document.querySelectorAll('.nav-btn, .mobile-nav-btn').forEach(btn => {

    btn.addEventListener('click', (e) => {

      const view = e.target.dataset.view;

      if (view) showView(view);

    });

  });

  const certInput = document.getElementById('certificate-id');

  if (certInput) {

    certInput.addEventListener('keypress', (e) => {

      if (e.key === 'Enter') {

        verifyCertificate();

      }

    });

  }

  document.addEventListener('input', (e) => {

    if (e.target.id === 'users-search') {

      filterUsersTable(e.target.value);

    } else if (e.target.id === 'courses-search') {

      filterCoursesTable(e.target.value);

    } else if (e.target.id === 'certificates-search') {

      filterCertificatesTable(e.target.value);

    }

  });

}

// Evento DOMContentLoaded

document.addEventListener('DOMContentLoaded', async function() {

  await loadUsers(); // Espera a que los usuarios se carguen

  loadCoursesFromLocalStorage();

  displayUsersTable();

  displayCoursesTable(); // Ahora usersCache está cargado

  const courseForm = document.getElementById('course-form');

  if (courseForm) {

    courseForm.addEventListener('submit', async function(e) {

      e.preventDefault();

      const title = document.getElementById('course-title').value;

      const description = document.getElementById('course-description').value;

      const duration = parseInt(document.getElementById('course-duration').value);

      const checkboxes = document.querySelectorAll('#course-users-checkboxes input[type="checkbox"]:checked');

      const selectedUsers = Array.from(checkboxes).map(checkbox => checkbox.value);

      const imageInput = document.getElementById('course-image');

      let imageBase64 = '';

      if (imageInput.files.length > 0) {

        const file = imageInput.files[0];

        imageBase64 = await uploadImage(file);

      } else if (currentCourseId) {

        const course = coursesCache.find(c => c.id === currentCourseId);

        if (course) {

          imageBase64 = course.image || '';

        }

      }

      if (currentCourseId) {

        // Editar curso existente

        coursesCache = coursesCache.map(c => {

          if (c.id === currentCourseId) {

            return {

              ...c,

              title,

              description,

              duration,

              image: imageBase64,

              users: selectedUsers // Guardar los usuarios seleccionados

            };

          }

          return c;

        });

      } else {

        // Crear nuevo curso

        const newId = coursesCache.length > 0 ? Math.max(...coursesCache.map(c => c.id)) + 1 : 1;

        coursesCache.push({

          id: newId,

          title,

          description,

          duration,

          image: imageBase64,

          users: selectedUsers // Guardar los usuarios seleccionados

        });

      }

      saveCoursesToLocalStorage();

      displayCoursesTable();

      loadGraduateData();

      document.getElementById('course-form-container').classList.add('hidden');

    });

  } else {

    console.error('Course form not found in the DOM.');

  }

  initializeApp();

  setupEventListeners();

  const userName = localStorage.getItem('userName');

  const logoutButton = document.querySelector('.logout-btn');

  if (!userName) {

    if (logoutButton) logoutButton.style.display = 'none';

  } else {

    document.querySelector('.user-info span').textContent = userName;

  }

  const userRole = localStorage.getItem('userRole');

  const adminBtns = document.querySelectorAll('.nav-btn[data-view="admin"], .mobile-nav-btn[data-view="admin"]');

  const graduateBtns = document.querySelectorAll('.nav-btn[data-view="graduate"], .mobile-nav-btn[data-view="graduate"]');

  const verifierBtns = document.querySelectorAll('.nav-btn[data-view="verifier"], .mobile-nav-btn[data-view="verifier"]');

  if (userRole === 'admin') {

    adminBtns.forEach(btn => btn.style.display = 'block');

    graduateBtns.forEach(btn => btn.style.display = 'none');

    verifierBtns.forEach(btn => btn.style.display = 'none');

    showView('admin');

  } else if (userRole === 'graduate') {

    adminBtns.forEach(btn => btn.style.display = 'none');

    graduateBtns.forEach(btn => btn.style.display = 'block');

    verifierBtns.forEach(btn => btn.style.display = 'block');

    showView('graduate');

  }

  loadInitialData();

});





login.html

<!DOCTYPE html>

<html lang="en">

<head>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Login - WeSpark</title>

    <link rel="stylesheet" href="prueba.css">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Scripts de Firebase (en este orden) -->

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<!-- Tu script personalizado -->

</head>

<body>

    <div class="login-container">

        <div class="login-card">

            <div class="logo">

                <i class="fas fa-graduation-cap"></i>

                <span>WeSpark</span>

            </div>

            <h2>Welcome back</h2>

            <p>Please enter your details to sign in</p>

            <form id="login-form">

                <div class="form-group">

                    <label for="email">Email</label>

                    <input type="email" id="email" required>

                </div>

                <div class="form-group">

                    <label for="password">Password</label>

                    <input type="password" id="password" required>

                </div>

                <button type="submit" class="btn btn-primary">Sign In</button>

            </form>

            <p class="login-footer">Don't have an account? <a href="register.html">Sign up</a></p>

            <!-- En login.html, dentro del formulario de login -->

<p class="login-footer">

    Did you forget your password? <a href="#" id="forgot-password-link">Recover it here</a>

    <br>

    Do you prefer to log in without a password? <a href="#" id="magic-link-request">Send a magic link</a>

</p>

        </div>

    </div>

    <!-- Modal para enlace mágico -->

<div id="magic-link-modal" class="modal hidden">

    <div class="modal-content">

        <span class="close-modal">&times;</span>

        <h2>Iniciar sesión con enlace mágico</h2>

        <p>Ingresa tu correo electrónico para recibir un enlace de inicio de sesión.</p>

        <div class="form-group">

            <label for="magic-link-email">Correo electrónico</label>

            <input type="email" id="magic-link-email" required>

        </div>

        <button class="btn btn-primary" onclick="sendMagicLink()">Enviar enlace mágico</button>

    </div>

</div>

    <!-- Modal para recuperación de contraseña -->

<div id="forgot-password-modal" class="modal hidden">

    <div class="modal-content">

        <span class="close-modal">&times;</span>

        <h2>Recover password</h2>

        <p>Enter your email address to receive a recovery link.</p>

        <div class="form-group">

            <label for="recovery-email">Email</label>

            <input type="email" id="recovery-email" required>

        </div>

        <button class="btn btn-primary" onclick="sendPasswordResetEmail()">Send recovery link</button>

    </div>

</div>

    <div id="toast-container"></div>

 

    <script src="login.js"></script>

</body>

</html>





login.js

// Configuración de Firebase

const firebaseConfig = {

  apiKey: "AIzaSyB43ne5sv_2-CzPC-GoNbBM5uNGiTHlQ0Q",

  authDomain: "users-ab3e0.firebaseapp.com",

  projectId: "users-ab3e0",

  storageBucket: "users-ab3e0.firebasestorage.app",

  messagingSenderId: "466535430209",

  appId: "1:466535430209:web:4e49fde0578fb037042ec0"

};

// Inicializar Firebase

const app = firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();

const db = firebase.firestore();

// Función para mostrar loading

function showLoading() {

  const loadingElement = document.getElementById('loading');

  if (loadingElement) loadingElement.classList.remove('hidden');

}

// Función para ocultar loading

function hideLoading() {

  const loadingElement = document.getElementById('loading');

  if (loadingElement) loadingElement.classList.add('hidden');

}

// Función para generar un token aleatorio

function generateRandomToken() {

  return crypto.randomUUID();

}

// Función para verificar si el correo existe en Firestore

async function checkIfEmailExists(email) {

  try {

    const usersRef = db.collection('users');

    const query = usersRef.where('email', '==', email).limit(1);

    const snapshot = await query.get();

    return !snapshot.empty;

  } catch (error) {

    console.error("Error verifying the email:", error);

    return false;

  }

}

// Función para enviar el enlace mágico

// Función para obtener la URL base según el entorno

function getBaseUrl() {

  // Si estás en localhost (desarrollo)

  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {

    return `http://${window.location.hostname}:${window.location.port}`;

  }

  // Si estás en GitHub Pages (producción)

  else if (window.location.hostname.includes('github.io')) {

    return 'https://most-improve123.github.io/LIMPPL';

  }

  // Para otros dominios (Render, Vercel, etc.)

  else {

    return `https://${window.location.hostname}`;

  }

}

// Función para enviar el enlace mágico (actualizada)

async function sendMagicLink() {

  const email = document.getElementById('magic-link-email').value;

  if (!email) {

    showToast('error', 'Email required', 'Please enter your email address.');

    return;

  }

  // Deshabilitar el botón para evitar múltiples clics

  const sendButton = document.querySelector('#magic-link-modal .btn-primary');

  sendButton.disabled = true;

  sendButton.textContent = 'Checking...';

  try {

    showLoading();

    // Verificar si el correo existe en Firestore

    const emailExists = await checkIfEmailExists(email);

    if (!emailExists) {

      showToast('error', 'Unregistered email', 'The email is not registered. Please register first.');

      return;

    }

    sendButton.textContent = 'Sending...';

    const token = generateRandomToken();

    localStorage.setItem('magicLinkToken', token);

    localStorage.setItem('magicLinkEmail', email);

    // Generar el enlace mágico con la URL base correcta

    const baseUrl = getBaseUrl();

    const magicLink = `${baseUrl}/login.html?token=${token}&email=${encodeURIComponent(email)}`;

    await sendBrevoMagicLinkEmail(email, magicLink);

    showToast('success', 'Link sent', 'Check your email to log in.');

    document.getElementById('magic-link-modal').classList.add('hidden');

  } catch (error) {

    console.error("Error sending the magic link:", error);

    showToast('error', 'Error', error.message);

  } finally {

    hideLoading();

    // Volver a habilitar el botón

    sendButton.disabled = false;

    sendButton.textContent = 'Send magic link';

  }

}

// Función para enviar el correo con Brevo

async function sendBrevoMagicLinkEmail(email, magicLink) {

  try {

    const response = await fetch('https://wespark-backend.onrender.com/send-magic-link', {

      method: 'POST',

      headers: {

        'Content-Type': 'application/json',

      },

      body: JSON.stringify({ email, magicLink }),

    });

    const data = await response.json();

    if (!response.ok) {

      throw new Error(data.error || 'Error sending the email.');

    }

    console.log("Email sent successfully:", data);

    return data;

  } catch (error) {

    console.error("Error sending the email:", error);

    throw error;

  }

}

// Manejo del modal de enlace mágico y recuperación de contraseña

document.addEventListener('DOMContentLoaded', function() {

  // Modal de recuperación de contraseña

  const forgotPasswordLink = document.getElementById('forgot-password-link');

  const modal = document.getElementById('forgot-password-modal');

  const closeModal = document.querySelector('.close-modal');

  if (forgotPasswordLink) {

    forgotPasswordLink.addEventListener('click', function(e) {

      e.preventDefault();

      modal.classList.remove('hidden');

    });

  }

  if (closeModal) {

    closeModal.addEventListener('click', function() {

      modal.classList.add('hidden');

    });

  }

  // Modal de enlace mágico

  const magicLinkRequest = document.getElementById('magic-link-request');

  const magicLinkModal = document.getElementById('magic-link-modal');

  const closeMagicLinkModal = magicLinkModal.querySelector('.close-modal');

  if (magicLinkRequest) {

    magicLinkRequest.addEventListener('click', function(e) {

      e.preventDefault();

      magicLinkModal.classList.remove('hidden');

    });

  }

  if (closeMagicLinkModal) {

    closeMagicLinkModal.addEventListener('click', function() {

      magicLinkModal.classList.add('hidden');

    });

  }

  // Verifica si hay un token en la URL al cargar la página

  const urlParams = new URLSearchParams(window.location.search);

  const token = urlParams.get('token');

  const email = urlParams.get('email');

  console.log('Token en URL:', token);

  console.log('Email en URL:', email);

  if (token && email) {

    const storedToken = localStorage.getItem('magicLinkToken');

    const storedEmail = localStorage.getItem('magicLinkEmail');

    console.log('Token almacenado:', storedToken);

    console.log('Email almacenado:', storedEmail);

    if (token === storedToken && email === storedEmail) {

      console.log('Token y email coinciden. Guardando datos en localStorage...');

      // Obtener el rol del usuario desde Firestore

      const usersRef = db.collection('users');

      const query = usersRef.where('email', '==', email).limit(1);

      query.get().then((querySnapshot) => {

        if (!querySnapshot.empty) {

          const userData = querySnapshot.docs[0].data();

          localStorage.setItem('userName', email.split('@')[0]);

          localStorage.setItem('userRole', userData.role);

          // Generar un UID simulado para mantener compatibilidad con prueba.js

          const simulatedUID = 'brevo-' + email.split('@')[0] + '-' + Date.now();

          localStorage.setItem('userUID', simulatedUID);

        } else {

          localStorage.setItem('userName', email.split('@')[0]);

          localStorage.setItem('userRole', 'graduate');

          // Generar un UID simulado para mantener compatibilidad con prueba.js

          const simulatedUID = 'brevo-' + email.split('@')[0] + '-' + Date.now();

          localStorage.setItem('userUID', simulatedUID);

        }

        showToast('success', 'Successful login', 'Welcome!');

        setTimeout(() => {

          window.location.href = 'prueba.html';

        }, 2000);

      }).catch((error) => {

        console.error("Error al obtener el rol del usuario:", error);

        // Si hay un error, asigna valores por defecto

        localStorage.setItem('userName', email.split('@')[0]);

        localStorage.setItem('userRole', 'graduate');

        // Generar un UID simulado para mantener compatibilidad con prueba.js

        const simulatedUID = 'brevo-' + email.split('@')[0] + '-' + Date.now();

        localStorage.setItem('userUID', simulatedUID);

        showToast('success', 'Successful login', 'Welcome!');

        setTimeout(() => {

          window.location.href = 'prueba.html';

        }, 2000);

      });

    } else {

      console.log('Token o email no coinciden.');

      showToast('error', 'Invalid link', 'The magic link is not valid or has expired.');

    }

  }

});

// Función para enviar el correo de recuperación de contraseña

function sendPasswordResetEmail() {

  const email = document.getElementById('recovery-email').value;

  if (!email) {

    showToast('error', 'Email required', 'Please enter your email address.');

    return;

  }

  auth.sendPasswordResetEmail(email)

    .then(() => {

      showToast('success', 'Email sent', 'Check your inbox to reset your password.');

      document.getElementById('forgot-password-modal').classList.add('hidden');

    })

    .catch((error) => {

      console.error("Error sending the recovery email:", error);

      showToast('error', 'Error', error.message);

    });

}

// Función para mostrar mensajes toast

function showToast(type, title, description = '') {

  const container = document.getElementById('toast-container');

  if (!container) {

    console.error("Toast container not found");

    return;

  }

  const toast = document.createElement('div');

  toast.className = `toast ${type}`;

  toast.innerHTML = `

    <div class="toast-header">

      <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>

      <div class="toast-title">${title}</div>

    </div>

    ${description ? `<div class="toast-description">${description}</div>` : ''}

  `;

  container.appendChild(toast);

  setTimeout(() => {

    if (toast.parentNode) {

      toast.parentNode.removeChild(toast);

    }

  }, 5000);

}

// Manejo del formulario de login

document.getElementById('login-form').addEventListener('submit', async function(e) {

  e.preventDefault();

  const email = document.getElementById('email').value;

  const password = document.getElementById('password').value;

  auth.setPersistence(firebase.auth.Auth.Persistence.SESSION)

    .then(() => {

      return auth.signInWithEmailAndPassword(email, password);

    })

    .then(async (userCredential) => {

      const user = userCredential.user;

      console.log("UID del usuario autenticado:", user.uid);

      localStorage.setItem('userUID', user.uid);

      const userDoc = await db.collection('users').doc(user.uid).get();

      if (userDoc.exists) {

        const userData = userDoc.data();

        localStorage.setItem('userName', userData.name);

        localStorage.setItem('userRole', userData.role);

      }

      showToast('success', 'Login successful!', 'Welcome back.');

      setTimeout(() => {

        window.location.href = 'prueba.html';

      }, 2000);

    })

    .catch((error) => {

      console.error("Error signing in: ", error);

      showToast('error', 'Login error', error.message);

    });

});





register.html

<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Register - WeSpark</title>

    <link rel="stylesheet" href="prueba.css">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

</head>

<body>

    <div class="login-container">

        <div class="login-card">

            <div class="logo">

                <i class="fas fa-graduation-cap"></i>

                <span>WeSpark</span>

            </div>

            <h2>Create an account</h2>

            <p>Please enter your details to sign up</p>

            <form id="register-form">

                <div class="form-group">

                    <label for="name">Full Name</label>

                    <input type="text" id="name" required>

                </div>

                <div class="form-group">

                    <label for="email">Email</label>

                    <input type="email" id="email" required>

                </div>

                <div class="form-group">

                    <label for="password">Password</label>

                    <input type="password" id="password" required>

                </div>

                <div class="form-group">

                    <label for="role">Role</label>

                    <select id="role" required>

                        <option value="graduate">Graduate</option>

                        <option value="admin">Admin</option>

                    </select>

                </div>

                <button type="submit" class="btn btn-primary">Sign Up</button>

            </form>

            <p class="login-footer">Already have an account? <a href="login.html">Sign in</a></p>

        </div>

    </div>

    <div id="toast-container"></div>

    <!-- Incluir los scripts de Firebase -->

    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

    <!-- Incluir tu script personalizado -->

    <script src="register.js"></script>

</body>

</html>





register.js

// Configuración de Firebase

const firebaseConfig = {

  apiKey: "AIzaSyB43ne5sv_2-CzPC-GoNbBM5uNGiTHlQ0Q",

  authDomain: "users-ab3e0.firebaseapp.com",

  projectId: "users-ab3e0",

  storageBucket: "users-ab3e0.firebasestorage.app",

  messagingSenderId: "466535430209",

  appId: "1:466535430209:web:4e49fde0578fb037042ec0"

};

// Inicializar Firebase

const app = firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();

const db = firebase.firestore();

// Función para manejar el registro de nuevos usuarios

document.getElementById('register-form').addEventListener('submit', async function(e) {

  e.preventDefault();

  const name = document.getElementById('name').value;

  const email = document.getElementById('email').value;

  const password = document.getElementById('password').value;

  const role = document.getElementById('role').value;

  // Validación de la contraseña

  if (password.length < 6) {

    showToast('error', 'Registration Failed', 'Password should be at least 6 characters.');

    return;

  }

  try {

    const userCredential = await auth.createUserWithEmailAndPassword(email, password);

    const user = userCredential.user;

    // Guardar información adicional del usuario en Firestore

    await db.collection('users').doc(user.uid).set({

      name: name,

      email: email,

      role: role,

      createdAt: firebase.firestore.FieldValue.serverTimestamp()

    });

    // Mostrar mensaje de éxito

    showToast('success', 'Registration Successful', 'You have successfully registered. Please sign in.');

    // Redirigir al usuario a la página de inicio de sesión

    setTimeout(() => {

      window.location.href = 'login.html';

    }, 2000);

  } catch (error) {

    console.error("Error signing up: ", error);

    showToast('error', 'Registration Failed', error.message);

  }

});

// Función para mostrar mensajes toast

function showToast(type, title, description = '') {

  const container = document.getElementById('toast-container');

  if (!container) {

    console.error("Toast container not found");

    return;

  }

  const toast = document.createElement('div');

  toast.className = `toast ${type}`;

  toast.innerHTML = `

    <div class="toast-header">

      <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>

      <div class="toast-title">${title}</div>

    </div>

    ${description ? `<div class="toast-description">${description}</div>` : ''}

  `;

  container.appendChild(toast);

  setTimeout(() => {

    if (toast.parentNode) {

      toast.parentNode.removeChild(toast);

    }

  }, 5000);

}





index.html

<!DOCTYPE html>

<html>

<head>

    <meta http-equiv="refresh" content="0; url=login.html" />

</head>

<body></body>

</html>



